webpackJsonp([1],{NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("7+uW"),a=s("zL8q"),r=s.n(a),n=(s("tvR6"),{render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view",{attrs:{name:"nav"}}),this._v(" "),e("router-view",{attrs:{name:"content"}})],1)},staticRenderFns:[]}),o=s("VU/8")({name:"App",data:function(){return{}}},n,!1,null,null,null).exports,l=s("/ocq"),c="获取短信验证码",u="秒后重新获取",d="您输入的手机不是管理员，请到小程序进行注册。",p={data:function(){return{tel:"",code:"",telError:!1,numError:!1,countdownRange:60,counting:!1}},computed:{codeButtonText:function(){return this.counting?""+this.countdownRange+u:""+c}},methods:{validate:function(){return/^1[34578][0-9]{9}$/.test(this.tel)},login:function(){var t=this;if(this.validate()&&6==this.code.length){var e={tel:this.tel,code:this.code};this.$http.post(this.GLOBAL.requestUrls.login,e).then(function(e){t.setCookie("token",e.headers.authorization,t.GLOBAL.expire),t.$router.push(t.GLOBAL.routers.projects)}).catch(function(e){422===e.response.status&&(t.numError=!0)})}else this.validate()&&6==!this.code.length?this.numError=!0:this.validate()||6!=this.code.length?(this.telError=!0,this.numError=!0):this.telError=!0},countdown:function(){this.counting=!0,this._count()},getCode:function(){var t=this;if(this.telError=!this.validate(),!this.telError){var e={tel:this.tel};this.$http.post(this.GLOBAL.requestUrls.code,e).then(function(e){t.countdown()}).catch(function(e){422===e.response.status&&(t.telError=!0),403===e.response.status&&t.$message.error(d)})}},_count:function(){if(0===this.countdownRange)return this.counting=!1,void(this.countdownRange=60);this.countdownRange--,setTimeout(this._count,1e3)}}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"login-com-container",staticStyle:{"background-image":"url('./static/images/login.jpg')"}},[s("el-card",{staticClass:"box-card"},[s("div",{staticClass:"login-title"},[s("span",{staticClass:"title-zn"},[t._v("预约管理系统")]),t._v(" "),s("span",{staticClass:"title-en"},[t._v("Reservation Management System")])]),t._v(" "),s("div",{staticClass:"login-content"},[s("div",{staticClass:"input-container"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.tel,expression:"tel"}],staticClass:"login-input",attrs:{type:"text",placeholder:"请输入手机号码",maxlength:"11"},domProps:{value:t.tel},on:{input:function(e){e.target.composing||(t.tel=e.target.value)}}}),t._v(" "),s("div",{staticClass:"error-msg tel-error"},[s("span",{directives:[{name:"show",rawName:"v-show",value:t.telError,expression:"telError"}]},[t._v("请输入正确的手机号")])])]),t._v(" "),s("div",{staticClass:"input-wrapper"},[s("div",{staticClass:"input-msg-container"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.code,expression:"code"}],staticClass:"login-input message-input",attrs:{type:"number",placeholder:"请输入6位短信验证码"},domProps:{value:t.code},on:{input:function(e){e.target.composing||(t.code=e.target.value)}}})]),t._v(" "),s("el-button",{attrs:{type:"text",disabled:t.counting},on:{click:t.getCode}},[t._v("\n          "+t._s(t.codeButtonText)+"\n        ")]),t._v(" "),s("div",{staticClass:"error-msg code-error"},[s("span",{directives:[{name:"show",rawName:"v-show",value:t.numError,expression:"numError"}]},[t._v("请输入正确的短信验证码")])])],1),t._v(" "),s("el-button",{staticClass:"login-btn",attrs:{type:"primary",disabled:""==t.tel||""==t.code},on:{click:t.login}},[t._v("\n        登录\n      ")])],1)])],1)},staticRenderFns:[]},h=s("VU/8")(p,m,!1,null,null,null).exports,v={props:{originUrl:{type:String,default:""},className:{type:String,default:""},imageWrapper:{type:String,default:""}},data:function(){return{imgClass:this.className,imgWrapperClass:this.imageWrapper}},computed:{fomatedUrl:function(){if(this.originUrl)return this.GLOBAL.server+this.originUrl}},methods:{handleOnload:function(){this.$emit("onLoad")}}},f={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{class:this.imgWrapperClass},[e("img",{class:this.imgClass,attrs:{src:this.fomatedUrl},on:{load:this.handleOnload}})])},staticRenderFns:[]},g=s("VU/8")(v,f,!1,null,null,null).exports,_={components:{"formated-image":g},data:function(){return{activeName:"project",projectsList:[],imageClass:"project-image"}},methods:{handleClick:function(t,e){console.log(t,e)},newProject:function(){this.$router.push(this.GLOBAL.routers.projects_new)},editProject:function(t){this.$router.push(this.GLOBAL.routers.projects_edit+this.projectsList[t].id)},showDetail:function(t){this.$router.push(this.GLOBAL.routers.reservations_details+this.projectsList[t].id+"/"+this.projectsList[t].name)}},mounted:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.projects,this.getRequestConfig()).then(function(e){t.projectsList=e.data.projects,t.setCookie("token",e.headers.authorization,t.GLOBAL.expire)}).catch(function(e){t.handleHttpError(e)})}},C={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"admin-com-container"},[s("div",{staticClass:"tabs-wrapper"},[s("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:"预约项目",name:"project"}},[s("div",{staticClass:"card-wrapper"},[s("div",{staticClass:"card-item add-card",on:{click:t.newProject}},[s("el-card",{staticClass:"box-card"},[s("div",{staticClass:"card-content"},[s("div",{staticClass:"card-icon"},[s("i",{staticClass:"el-icon-circle-plus"})]),t._v(" "),s("p",[t._v("创建新的预约项目")])])])],1),t._v(" "),t._l(t.projectsList,function(e,i){return s("div",{staticClass:"card-item project",on:{click:function(e){t.showDetail(i)}}},[s("formated-image",{staticClass:"image-wrapper",attrs:{originUrl:e.image,className:t.imageClass}}),t._v(" "),s("span",{staticClass:"project-name"},[t._v(t._s(e.name))]),t._v(" "),"open"===e.state?s("span",{staticClass:"project-state"},[t._v("开启")]):s("span",{staticClass:"project-state"},[t._v("关闭")]),t._v(" "),s("span",{staticClass:"project-share"},[s("i",{staticClass:"el-icon-edit",on:{click:function(e){e.stopPropagation(),t.editProject(i)}}}),t._v(" "),s("i",{staticClass:"el-icon-share"})])],1)})],2)]),t._v(" "),s("el-tab-pane",{attrs:{label:"分类",name:"category"}})],1)],1)])},staticRenderFns:[]},k=s("VU/8")(_,C,!1,null,null,null).exports,w={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"nav-com-container"},[s("span",{staticClass:"nav-title"},[t._v("预约系统")]),t._v(" "),s("div",{staticClass:"drop-wrapper"},[s("el-dropdown",{attrs:{trigger:"click"},on:{command:t.handleCommand}},[s("span",{staticClass:"el-dropdown-link nick-name"},[t._v("\n        "+t._s(t.nickeName)),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",[t._v("修改个人消息")]),t._v(" "),s("el-dropdown-item",[t._v("查看回收站")]),t._v(" "),s("el-dropdown-item",[t._v("我的邀请")]),t._v(" "),s("el-dropdown-item",{attrs:{command:"logout"}},[t._v("退出")])],1)],1)],1)])},staticRenderFns:[]},b=s("VU/8")({data:function(){return{nickeName:"晨晨"}},methods:{handleCommand:function(t){"logout"===t&&this.logout()},logout:function(){this.delCookie("token"),this.$router.push(this.GLOBAL.routers.login)}}},w,!1,null,null,null).exports,L=s("mvHQ"),S=s.n(L),j={components:{"formated-image":g},props:{image:{type:String,default:""}},data:function(){return{coverModalVisible:!1,currentImage:this.image,defaultImageList:[],classNames:{form_cover:"form-cover",default_cover:"img",image_wrapper:"item-img-wrapper",cover_wrapper:"cover-wrapper"}}},created:function(){this.getCovers()},methods:{getCovers:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.covers).then(function(e){t.defaultImageList=e.data.images,""===t.currentImage&&(t.currentImage=t.defaultImageList[0])})},handleImageOnload:function(t){this.loading&&this.loading.close()},handleUpload:function(){var t=this;this.loading=this.$loading({target:".img-wrapper",background:"#f1f1f1"}),lrz(this.$refs.uploadImageRef.files[0]).then(function(e){var s=new FormData;s.append("image",e.formData.get("file")),t.$http.post(t.GLOBAL.requestUrls.image,s,t.getRequestConfig()).then(function(e){t.currentImage=e.data.image,t.setCookie("token",e.headers.authorization,t.GLOBAL.expire)}).catch(function(e){t.handleHttpError(e)})}),this.coverModalVisible=!1},changeCover:function(t){this.currentImage=this.defaultImageList[t],this.coverModalVisible=!1},updateValue:function(t){this.currentImage=t},getData:function(){return this.currentImage}}},x={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"img-wrapper"},[s("formated-image",{attrs:{originUrl:t.currentImage,className:t.classNames.form_cover,imageWrapper:t.classNames.cover_wrapper},on:{onLoad:t.handleImageOnload}}),t._v(" "),s("div",{staticClass:"change-cover-btn"},[s("el-button",{staticClass:"change-cover",attrs:{type:"primary"},on:{click:function(e){t.coverModalVisible=!0}}},[t._v("更换封面")]),t._v(" "),s("el-dialog",{attrs:{title:"更换封面",visible:t.coverModalVisible,width:"858px",center:""},on:{"update:visible":function(e){t.coverModalVisible=e}}},[s("div",{staticClass:"imgs-list"},[s("div",{staticClass:"upload imgs-item"},[s("label",{attrs:{for:"file_input"}},[s("i",{staticClass:"el-icon-upload"}),t._v(" "),s("div",[t._v("上传图片")])]),t._v(" "),s("input",{ref:"uploadImageRef",attrs:{type:"file",id:"file_input",accept:"image/*"},on:{change:t.handleUpload}})]),t._v(" "),t._l(t.defaultImageList,function(e,i){return s("div",{staticClass:"imgs-item",on:{click:function(e){t.changeCover(i)}}},[s("formated-image",{attrs:{originUrl:e,className:t.classNames.default_cover,imageWrapper:t.classNames.image_wrapper}})],1)})],2)])],1)],1)},staticRenderFns:[]},y=s("VU/8")(j,x,!1,null,null,null).exports,$={props:{address:{type:String,default:""},latitude:{type:Number,default:0},longitude:{type:Number,default:0}},data:function(){return{currentAddress:this.address,currentLatitude:this.latitude,currentLongitude:this.longitude,isShowMap:!1,isShowPanel:!1,isInitMap:!0,markers:[]}},methods:{handleFocus:function(){this.isShowMap=!0,this.$route.params.id&&this.isInitMap?(this.mapInit(),this.isInitMap=!1):this.currentLatitude&&this.currentLongitude&&this.currentAddress?this.renderOriginLocation():this.currentAddress||(this.mapInit(),this.currentLatitude=0,this.currentLongitude=0)},mapInit:function(){this.map=new AMap.Map("map-container",{zoom:12}),this.geocoderInit(),this.placeSearchInit(),this.infoWindowInit(),this.mapClick(),this.renderOriginLocation()},geocoderInit:function(){var t=this;AMap.plugin("AMap.Geocoder",function(){t.geocoder=new AMap.Geocoder({radius:1e3,extensions:"all"}),t.map.addControl(t.geocoder)})},placeSearchInit:function(){var t=this;AMap.service(["AMap.PlaceSearch"],function(){t.placeSearch=new AMap.PlaceSearch({pageSize:5,pageIndex:1,city:"028",map:t.map,panel:"map-panel",renderStyle:"default"})})},infoWindowInit:function(){var t=this;AMap.plugin("AMap.InfoWindow",function(){t.infoWindow=new AMap.InfoWindow({content:"",autoMove:!0,closeWhenClickMap:!0})})},renderOriginLocation:function(){if(this.currentLatitude&&this.currentLongitude&&this.currentAddress){var t=new AMap.Marker({position:[this.currentLongitude,this.currentLatitude]});t.setMap(this.map),this.map.setZoom(14),this.map.setCenter([this.currentLongitude,this.currentLatitude]),this.markers.push(t),this.renderInfoWindow(this.currentLongitude,this.currentLatitude,t)}},mapClick:function(){var t=this;this.map.on("click",function(e){var s=e.lnglat.getLng(),i=e.lnglat.getLat();t.map.remove(t.markers),t.updatePosition(s,i),t.setMarker(s,i),t.placeSearch.clear()}),this.placeSearch.on("listElementClick",function(e){t.updateValue(t.getPositionInfo(e))}),this.placeSearch.on("markerClick",function(e){t.updateValue(t.getPositionInfo(e))})},getPositionInfo:function(t){return{latitude:t.data.location.lat,longitude:t.data.location.lng,address:t.data.cityname+t.data.adname+t.data.address}},setMarker:function(t,e){var s=new AMap.Marker({position:[t,e]});s.setMap(this.map),this.map.setZoom(14),this.map.setCenter([t,e]),this.markers.push(s),this.renderInfoWindow(t,e,s)},renderInfoWindow:function(t,e,s){var i=this;this.geocoder.getAddress([t,e],function(a,r){"complete"===a&&"OK"===r.info&&(i.currentAddress=r.regeocode.formattedAddress,i.infoWindow.setContent("<div>"+r.regeocode.formattedAddress+"</div"),i.infoWindow.open(i.map,[t,e]),s.on("click",function(){i.infoWindow.open(i.map,[t,e]),i.updatePosition(t,e)}))})},search:function(){this.isShowMap&&(this.isShowPanel=!0,this.map.remove(this.markers),this.infoWindow.close(),this.placeSearch.search(this.currentAddress))},closeMap:function(){this.isShowPanel=!1,this.placeSearch.clear(),this.isShowMap=!1},updateValue:function(t){this.currentAddress=t.address,this.currentLatitude=t.latitude,this.currentLongitude=t.longitude},updatePosition:function(t,e){this.currentLatitude=e,this.currentLongitude=t},getData:function(){return{address:this.currentAddress,latitude:this.currentLatitude,longitude:this.currentLongitude}}}},T={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"form-address"},[s("span",{staticClass:"address-text"},[t._v("详细地址: ")]),t._v(" "),s("el-input",{staticClass:"address-input",on:{focus:t.handleFocus},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.search(e):null}},model:{value:t.currentAddress,callback:function(e){t.currentAddress=e},expression:"currentAddress"}},[s("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.search},slot:"append"})],1)],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowMap,expression:"isShowMap"}],attrs:{id:"map-container"}}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowPanel,expression:"isShowPanel"}],attrs:{id:"map-panel"}}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowMap,expression:"isShowMap"}],staticClass:"map-close",on:{click:t.closeMap}},[s("i",{staticClass:"el-icon-close"})])])},staticRenderFns:[]},V=s("VU/8")($,T,!1,null,null,null).exports,A=s("fZjL"),D=s.n(A),I={Mon:"周一",Tues:"周二",Wed:"周三",Thur:"周四",Fri:"周五",Sat:"周六",Sun:"周日",Holiday:"法定节假日"},R="请填写时间段和重复日期",M="已存在相同时间段",O="请输入正确的时间段",E=[{value:"Mon",label:"周一"},{value:"Tues",label:"周二"},{value:"Wed",label:"周三"},{value:"Thur",label:"周四"},{value:"Fri",label:"周五"},{value:"Sat",label:"周六"},{value:"Sun",label:"周日"},{value:"Holiday",label:"法定节假日"}],B={props:{timeState:{type:Object,default:{normal:[{time:"09:00-10:00",limit:10,weekday:["Mon","Tues","Wed","Thur","Fri"]}],special:[]}}},data:function(){return{weekdays:E,currentTimeState:this.timeState,settingDialogVisible:!1,isShowNormal:!0,weekdayValue:["Mon","Tues","Wed","Thur","Fri"],limitValue:"",startTime:"",endTime:"",editStatus:!1,editIndex:null}},computed:{formatedTimeState:function(){return this.currentTimeState.normal.map(function(t){var e=t.weekday.map(function(t){return I[t]});return{time:t.time,limit:t.limit,weekday:e}})}},methods:{newItem:function(){this.settingDialogVisible=!0,this.startTime="09:00",this.endTime="10:00",this.weekdayValue=["Mon","Tues","Wed","Thur","Fri"],this.limitValue=" "},validateEmpty:function(){return this.error={},this.startTime&&this.endTime&&this.weekdayValue.length||(this.error.empty_tip=R),0==D()(this.error).length},validateNewTime:function(t){var e=this;return this.error={},this.currentTimeState.normal.forEach(function(s){s.time==t&&(e.error.repeat_tip=M)}),0==D()(this.error).length},validateEditTime:function(t){var e=this;return this.error={},this.currentTimeState.normal.forEach(function(s,i){i!==e.editIndex&&s.time===t&&(e.error.repeat_tip=M)}),0==D()(this.error).length},validateTime:function(t,e){return this.error={},t>=e&&(this.error.invalid_tip=O),0==D()(this.error).length},compeleteSetting:function(){var t,e={},s=this.startTime+"-"+this.endTime,i=this.weekdayValue;t=" "===this.limitValue||""===this.limitValue?null:Math.abs(parseInt(this.limitValue)),this.validateEmpty()?(e={time:s,limit:t,weekday:i},this.validateTime(this.startTime,this.endTime)?this.editStatus?this.validateEditTime(s)?(this.currentTimeState.normal.splice(this.editIndex,1,e),this.settingDialogVisible=!1):this.$message.error(this.error.repeat_tip):this.validateNewTime(s)?(this.currentTimeState.normal.push(e),this.settingDialogVisible=!1):this.$message.error(this.error.repeat_tip):(this.settingDialogVisible=!0,this.$message.error(this.error.invalid_tip))):(this.settingDialogVisible=!0,this.$message.error(this.error.empty_tip))},deleteItem:function(t){this.currentTimeState.normal.splice(t,1)},editItem:function(t){this.settingDialogVisible=!0;var e=this.currentTimeState.normal[t];this.startTime=e.time.split("-")[0],this.endTime=e.time.split("-")[1],this.weekdayValue=e.weekday,this.limitValue=null===e.limit?" ":e.limit,this.editStatus=!0,this.editIndex=t},updateValue:function(t){this.currentTimeState=t},getData:function(){return this.currentTimeState}}},N={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"form-settime-wrapper"},[s("el-radio-group",{staticClass:"setting-pattern",model:{value:t.isShowNormal,callback:function(e){t.isShowNormal=e},expression:"isShowNormal"}},[s("el-radio-button",{attrs:{label:!0}},[t._v("常规设置")]),t._v(" "),s("el-radio-button",{attrs:{label:!1}},[t._v("特殊设置")])],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowNormal,expression:"isShowNormal"}],staticClass:"normal-setting-wrapper"},[s("div",{staticClass:"normal-setting-item-wrapper"},t._l(t.formatedTimeState,function(e,i){return s("div",{staticClass:"normal-setting-item"},[s("span",{staticClass:"item-left"},[t._v(t._s(e.time))]),t._v(" "),s("div",{staticClass:"item-right"},[s("div",{staticClass:"weekday-container",on:{click:function(e){t.editItem(i)}}},t._l(e.weekday,function(e){return s("span",{staticClass:"weekday"},[t._v(t._s(e))])})),t._v(" "),null===e.limit?s("span",{staticClass:"number"},[t._v("名额不限制")]):s("span",{staticClass:"number"},[t._v("名额"+t._s(e.limit)+"人")])]),t._v(" "),s("span",{staticClass:"operate-btn"},[s("i",{staticClass:"el-icon-circle-plus-outline",on:{click:t.newItem}}),t._v(" "),s("i",{directives:[{name:"show",rawName:"v-show",value:t.formatedTimeState.length>1,expression:"formatedTimeState.length > 1"}],staticClass:"el-icon-remove-outline",on:{click:function(e){t.deleteItem(i)}}})])])})),t._v(" "),s("el-dialog",{attrs:{title:"预约时间设置",visible:t.settingDialogVisible,width:"600px",center:""},on:{"update:visible":function(e){t.settingDialogVisible=e},close:function(e){t.editStatus=!1}}},[s("div",{staticClass:"setting-content"},[s("div",{staticClass:"fields"},[s("span",{staticClass:"text"},[t._v("时间段: ")]),t._v(" "),s("el-time-picker",{attrs:{placeholder:"开始时间","value-format":"HH:mm",format:"HH:mm"},model:{value:t.startTime,callback:function(e){t.startTime=e},expression:"startTime"}}),t._v(" "),s("span",{staticClass:"middle-text"},[t._v("至")]),t._v(" "),s("el-time-picker",{attrs:{placeholder:"结束时间","value-format":"HH:mm",format:"HH:mm"},model:{value:t.endTime,callback:function(e){t.endTime=e},expression:"endTime"}})],1),t._v(" "),s("div",{staticClass:"fields"},[s("span",{staticClass:"text"},[t._v("重复:")]),t._v(" "),s("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.weekdayValue,callback:function(e){t.weekdayValue=e},expression:"weekdayValue"}},t._l(t.weekdays,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),s("div",{staticClass:"fields"},[s("span",{staticClass:"text"},[t._v("名额限制: ")]),t._v(" "),s("el-input",{staticClass:"count-input",attrs:{placeholder:"不填写则默认为无限制",type:"number"},model:{value:t.limitValue,callback:function(e){t.limitValue=e},expression:"limitValue"}})],1)]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.settingDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.compeleteSetting}},[t._v("确 定")])],1)])],1)],1)},staticRenderFns:[]},U="拼命加载中",G="预约项目名称不能为空",P={components:{"cover-picker":y,"address-picker":V,"time-setter":s("VU/8")(B,N,!1,null,null,null).exports},data:function(){return{form:{image:"",name:"",description:"",address:"",latitude:0,longitude:0,check_mode:"auto",time_state:{normal:[{time:"09:00-10:00",limit:10,weekday:["Mon","Tues","Wed","Thur","Fri"]}],special:[]}}}},created:function(){var t=this;if(this.$route.params.id){var e=this.$loading({text:U,spinner:"el-icon-loading",customClass:"loading-style"});this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id,this.getRequestConfig()).then(function(s){t.form=s.data,t.updateProps(t.form),e.close()}).catch(function(s){e.close(),t.handleHttpError(s)})}},methods:{updateProps:function(t){var e={};e.address=t.address,e.latitude=t.latitude,e.longitude=t.longitude,this.$refs.coverPickerRef.updateValue(t.image),this.$refs.addressPickerRef.updateValue(e),this.$refs.timeSetterRef.updateValue(t.time_state)},getComponentsData:function(){this.form.image=this.$refs.coverPickerRef.getData(),this.form.time_state=this.$refs.timeSetterRef.getData();var t=this.$refs.addressPickerRef.getData();this.form.address=t.address,this.form.latitude=t.latitude,this.form.longitude=t.longitude},getFormData:function(){var t=this;this.getComponentsData();var e=new FormData;return["name","description","address","latitude","longitude","check_mode","image"].forEach(function(s){e.append(s,t.form[s])}),e.append("time_state",S()(this.form.time_state)),e},submitForm:function(){var t=this,e=this.getFormData();this.form.name?this.$route.params.id?this.$http.put(this.GLOBAL.requestUrls.project+this.$route.params.id,e,this.getRequestConfig()).then(function(e){t.setCookie("token",e.headers.authorization,t.GLOBAL.expire),t.$router.push(t.GLOBAL.routers.projects),t.$message.success("修改"+t.form.name+"预约项目成功")}).catch(function(e){t.handleHttpError(e)}):this.$http.post(this.GLOBAL.requestUrls.projects,e,this.getRequestConfig()).then(function(e){t.setCookie("token",e.headers.authorization,t.GLOBAL.expire),t.$router.push(t.GLOBAL.routers.projects),t.$message.success("添加"+t.form.name+"预约项目成功")}).catch(function(e){t.handleHttpError(e)}):this.$message.error(G)}}},q={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"form-com-container"},[s("div",{staticClass:"form-wrapper"},[s("div",{staticClass:"return-to-prev"},[s("router-link",{attrs:{to:"/admin/projects"}},[s("i",{staticClass:"el-icon-back"})]),t._v(" "),this.$route.params.id?s("span",[t._v("修改预约项目")]):s("span",[t._v("创建预约项目")])],1),t._v(" "),s("el-form",{ref:"form",attrs:{model:t.form}},[s("el-form-item",[s("cover-picker",{ref:"coverPickerRef",attrs:{image:t.form.image}})],1),t._v(" "),s("el-form-item",[s("div",{staticClass:"title-wrapper"},[s("el-input",{attrs:{placeholder:"请输入预约项目名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)]),t._v(" "),s("el-form-item",[s("div",{staticClass:"desc-wrapper"},[s("el-input",{attrs:{type:"textarea",rows:5,placeholder:"预约详情介绍或预约注意事项"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)]),t._v(" "),s("el-form-item",[s("address-picker",{ref:"addressPickerRef",attrs:{address:t.form.address,latitude:t.form.latitude,longitude:t.form.longitude}})],1),t._v(" "),s("el-form-item",[s("div",{staticClass:"form-check"},[s("span",{staticClass:"check-text"},[t._v("审核模式: ")]),t._v(" "),s("el-radio",{attrs:{label:"auto"},model:{value:t.form.check_mode,callback:function(e){t.$set(t.form,"check_mode",e)},expression:"form.check_mode"}},[t._v("自动审核")]),t._v(" "),s("el-radio",{attrs:{label:"manual"},model:{value:t.form.check_mode,callback:function(e){t.$set(t.form,"check_mode",e)},expression:"form.check_mode"}},[t._v("人工审核")])],1)]),t._v(" "),s("el-form-item",[s("div",{staticClass:"form-time-period-select"},[s("span",{staticClass:"select-text"},[t._v("预约时间设置:")])])]),t._v(" "),s("el-form-item",[s("time-setter",{ref:"timeSetterRef",attrs:{timeState:t.form.time_state}})],1)],1),t._v(" "),s("div",{staticClass:"form-btn"},[s("el-button",[s("router-link",{attrs:{to:"/admin/projects"}},[t._v("取消")])],1),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.submitForm}},[t._v("确定")])],1)],1)])},staticRenderFns:[]},H=s("VU/8")(P,q,!1,null,null,null).exports,W={success:"已成功",wait:"待审核",cancelled:"已取消",checked:"已核销",overtime:"已过期"},F=[{value:"",label:"全部"},{value:"wait",label:W.wait},{value:"success",label:W.success},{value:"cancelled",label:W.cancelled},{value:"checked",label:W.checked},{value:"overtime",label:W.overtime}],z="取消预约",Z="核销预约",J="通过预约",K="拼命加载中",Q={"已成功":z,"待审核":z},X={"已成功":Z,"待审核":J},Y={data:function(){return{reservations:[],totalReservations:0,projectState:"",reservationsDate:[],reservationsTel:"",reservationsState:"",reservationsStateOptions:F,processDialogVisible:!1,stateDialogVisible:!1,confirmButtonDisabled:!1,modalTitle:"",operateRemark:"",stateCountObj:{}}},computed:{formatedReservations:function(){return this.reservations.map(function(t){return W[t.state]&&(t.state=W[t.state]),t})}},created:function(){var t=this.$loading({text:K,spinner:"el-icon-loading",customClass:"loading-style"});this.getProjectState(t),this.getReservations(),this.getStateCount()},methods:{search:function(){this.filter(1)},filter:function(t){var e=this;this.$http({method:"get",url:this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations",headers:{Authorization:this.getCookie("token")},params:{tel:this.reservationsTel,date_to:this.reservationsDate.length?this.reservationsDate[1]:"",date_from:this.reservationsDate.length?this.reservationsDate[0]:"",state:this.reservationsState,page:t}}).then(function(t){e.reservations=t.data.reservations,e.totalReservations=t.data.count}).catch(function(t){e.handleHttpError(t)})},dismiss:function(t,e){this.reservationsIndex=t,this.modalTitle=Q[e],this.processDialogVisible=!0},allow:function(t,e){this.reservationsIndex=t,this.modalTitle=X[e],this.processDialogVisible=!0},handleAllow:function(t,e){var s=this;this.processDialogVisible&&(this.confirmButtonDisabled=!0,this.$http({method:"post",url:this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations/"+this.reservations[this.reservationsIndex].id+t,headers:{Authorization:this.getCookie("token")}}).then(function(t){s.reservations[s.reservationsIndex].state=W[e],s.getStateCount(),s.processDialogVisible=!1,s.confirmButtonDisabled=!1}).catch(function(t){s.confirmButtonDisabled=!1,s.handleHttpError(t)}))},handleDismiss:function(t,e){var s=this;this.processDialogVisible&&(this.confirmButtonDisabled=!0,this.$http({method:"post",url:this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations/"+this.reservations[this.reservationsIndex].id+t,headers:{Authorization:this.getCookie("token")},data:{remark:this.operateRemark}}).then(function(t){s.reservations[s.reservationsIndex].state=W[e],s.reservations[s.reservationsIndex].remark=s.operateRemark,s.operateRemark="",s.getStateCount(),s.processDialogVisible=!1,s.confirmButtonDisabled=!1}).catch(function(t){s.confirmButtonDisabled=!1,s.handleHttpError(t)}))},confirm:function(){this.modalTitle===z?this.handleDismiss("/cancel","cancelled"):this.modalTitle===Z?this.handleAllow("/check","checked"):this.modalTitle===J&&this.handleAllow("/pass","success")},handleCurrentChange:function(t){this.filter(t)},changeState:function(t){t?this.openProject():(this.projectState=!0,this.stateDialogVisible=!0)},closeProject:function(){var t=this;this.stateDialogVisible&&(this.confirmButtonDisabled=!0,this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id+"/pause",this.getRequestConfig()).then(function(e){t.getReservations(),t.getStateCount(),t.projectState=!1,t.stateDialogVisible=!1,t.confirmButtonDisabled=!1}).catch(function(e){t.confirmButtonDisabled=!1,t.handleHttpError(e)}))},openProject:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id+"/open",this.getRequestConfig()).then(function(t){}).catch(function(e){t.handleHttpError(e)})},getStateCount:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations/count",this.getRequestConfig()).then(function(e){t.stateCountObj=e.data}).catch(function(e){t.handleHttpError(e)})},getReservations:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations",this.getRequestConfig()).then(function(e){t.reservations=e.data.reservations,t.totalReservations=e.data.count}).catch(function(e){t.handleHttpError(e)})},getProjectState:function(t){var e=this;this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id,this.getRequestConfig()).then(function(s){"open"===s.data.state?e.projectState=!0:e.projectState=!1,t.close()}).catch(function(s){t.close(),e.handleHttpError(s)})}}},tt={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"detail-com-container"},[s("div",{staticClass:"return-to-prev"},[s("router-link",{attrs:{to:"/admin/projects"}},[s("i",{staticClass:"el-icon-back"})]),t._v(" "),s("span",{staticClass:"reservation-name"},[t._v(t._s(this.$route.params.projectName)+"预约记录")]),t._v(" "),s("span",{staticClass:"project-state"},[t._v("开启预约")]),t._v(" "),s("el-switch",{attrs:{"active-color":"#409EFF","inactive-color":"#909997"},on:{change:t.changeState},model:{value:t.projectState,callback:function(e){t.projectState=e},expression:"projectState"}}),t._v(" "),s("el-dialog",{attrs:{title:"确认关闭",visible:t.stateDialogVisible,width:"500px"},on:{"update:visible":function(e){t.stateDialogVisible=e}}},[s("span",[t._v("关闭项目后，该项目下的所有预约都会被自动取消，您确认要关闭么?")]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.stateDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.confirmButtonDisabled},on:{click:t.closeProject}},[t._v("确 定")])],1)])],1),t._v(" "),s("div",{staticClass:"reservations-list"},[s("div",{staticClass:"reservations-search"},[s("el-date-picker",{staticClass:"date-picker",attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:t.reservationsDate,callback:function(e){t.reservationsDate=e},expression:"reservationsDate"}}),t._v(" "),s("div",{staticClass:"reservations-tel"},[s("span",[t._v("联系电话: ")]),t._v(" "),s("el-input",{staticClass:"tel-input",model:{value:t.reservationsTel,callback:function(e){t.reservationsTel=e},expression:"reservationsTel"}})],1),t._v(" "),s("div",{staticClass:"reservations-state"},[s("span",[t._v("预约状态: ")]),t._v(" "),s("el-select",{staticClass:"state-select",model:{value:t.reservationsState,callback:function(e){t.reservationsState=e},expression:"reservationsState"}},t._l(t.reservationsStateOptions,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),s("el-button",{staticClass:"search-btn",attrs:{type:"primary"},on:{click:t.search}},[t._v("查询")])],1),t._v(" "),s("div",{staticClass:"reservations-list-body"},[s("div",{staticClass:"list-wrapper"},[t._m(0),t._v(" "),t._l(t.formatedReservations,function(e,i){return s("div",{key:e.id,staticClass:"table-item"},[s("span",{staticClass:"item"},[t._v(t._s(e.name))]),t._v(" "),s("span",{staticClass:"item"},[t._v(t._s(e.state))]),t._v(" "),s("span",{staticClass:"item"},[t._v(t._s(e.tel))]),t._v(" "),s("span",{staticClass:"item"},[t._v(t._s(e.date))]),t._v(" "),s("span",{staticClass:"item"},[t._v(t._s(e.time))]),t._v(" "),s("span",{staticClass:"remark item"},[t._v(t._s(e.remark))]),t._v(" "),"已成功"===e.state?s("span",{staticClass:"operate item"},[s("span",{staticClass:"operate-set",on:{click:function(s){t.allow(i,e.state)}}},[t._v("核销")]),t._v(" "),s("span",{staticClass:"operate-set",on:{click:function(s){t.dismiss(i,e.state)}}},[t._v("取消")])]):"待审核"===e.state?s("span",{staticClass:"operate item"},[s("span",{staticClass:"operate-set",on:{click:function(s){t.allow(i,e.state)}}},[t._v("通过")]),t._v(" "),s("span",{staticClass:"operate-set",on:{click:function(s){t.dismiss(i,e.state)}}},[t._v("取消")])]):s("span",{staticClass:"operate item"},[t._v("---")])])})],2),t._v(" "),s("el-dialog",{ref:"modalRef",attrs:{title:t.modalTitle,visible:t.processDialogVisible,width:"500px"},on:{"update:visible":function(e){t.processDialogVisible=e}}},["取消预约"===t.modalTitle?s("el-input",{staticClass:"border-bottom",attrs:{placeholder:"请输入处理意见"},model:{value:t.operateRemark,callback:function(e){t.operateRemark=e},expression:"operateRemark"}}):"核销预约"===t.modalTitle?s("span",[t._v("是否核销该预约?")]):s("span",[t._v("是否通过该预约?")]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.processDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.confirmButtonDisabled},on:{click:t.confirm}},[t._v("确 定")])],1)],1),t._v(" "),s("div",{staticClass:"reservations-list-bottom"},[s("div",{staticClass:"state-count"},[s("span",[t._v("总计: "+t._s(t.stateCountObj.total))]),t._v(" "),s("span",[t._v("待审核: "+t._s(t.stateCountObj.wait))]),t._v(" "),s("span",[t._v("已成功: "+t._s(t.stateCountObj.success))]),t._v(" "),s("span",[t._v("已核销: "+t._s(t.stateCountObj.checked))]),t._v(" "),s("span",[t._v("已拒绝: "+t._s(t.stateCountObj.refused))]),t._v(" "),s("span",[t._v("已取消: "+t._s(t.stateCountObj.cancelled))]),t._v(" "),s("span",[t._v("已过期: "+t._s(t.stateCountObj.overtime))])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.reservations.length,expression:"reservations.length"}],staticClass:"pagination-wrapper"},[s("el-pagination",{attrs:{"page-size":10,layout:"prev, pager, next, jumper",total:t.totalReservations},on:{"current-change":t.handleCurrentChange}})],1)])],1)])])},staticRenderFns:[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"table-item table-head"},[s("span",{staticClass:"item"},[t._v("姓名")]),t._v(" "),s("span",{staticClass:"item"},[t._v("预约状态")]),t._v(" "),s("span",{staticClass:"item"},[t._v("联系电话")]),t._v(" "),s("span",{staticClass:"item"},[t._v("预约时间")]),t._v(" "),s("span",{staticClass:"item"},[t._v("预约时间段")]),t._v(" "),s("span",{staticClass:"remark item"},[t._v("备注")]),t._v(" "),s("span",{staticClass:"operate item"},[t._v("操作")])])}]},et=s("VU/8")(Y,tt,!1,null,null,null).exports;i.default.use(l.a);var st=new l.a({routes:[{path:"/",components:{nav:b,content:k}},{path:"/login",components:{nav:"",content:h}},{path:"/admin/projects",components:{nav:b,content:k}},{path:"/admin/projects/new",components:{nav:b,content:H}},{path:"/admin/projects/edit/:id",components:{nav:b,content:H}},{path:"/admin/projects/reservation/:id/:projectName",components:{nav:b,content:et}}],mode:"hash"}),it=s("mtWM"),at=s.n(it),rt=s("Rf8U"),nt=s.n(rt),ot=(s("U7mS"),s("rdV6"),"http://www.axuzz.cn"),lt={server:ot,expire:1296e5,routers:{login:"/login",projects:"/admin/projects",projects_new:"/admin/projects/new",projects_edit:"/admin/projects/edit/",reservations_details:"/admin/projects/reservation/"},requestUrls:{code:ot+"/code",login:ot+"/login",projects:ot+"/projects",project:ot+"/projects/",covers:ot+"/covers",image:ot+"/image"},httpStateInfo:{invalid_token:"Invalid Token"}},ct=s("VU/8")(lt,null,!1,null,null,null).exports;function ut(t){var e,s=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(s))?e[2]:null}function dt(t){var e=new Date;e.setTime(e.getTime()-1);var s=ut(t);null!=s&&(document.cookie=t+"="+s+";expires="+e.toGMTString())}i.default.config.productionTip=!1,i.default.use(r.a),i.default.use(nt.a,at.a),i.default.prototype.setCookie=function(t,e,s){var i=new Date;i.setTime(i.getTime()+s),document.cookie=t+"="+escape(e)+(null==s?"":";expires="+i.toGMTString())},i.default.prototype.getCookie=ut,i.default.prototype.delCookie=dt,i.default.prototype.handleHttpError=function(t){401===t.response.status&&(t.response.data===ct.httpStateInfo.invalid_token?(dt("token"),st.push(ct.routers.login),r.a.Message.error("登录已过期，请重新登录。")):st.push(ct.routers.projects))},i.default.prototype.getRequestConfig=function(){return{headers:{Authorization:ut("token")}}},i.default.prototype.GLOBAL=ct,new i.default({el:"#app",router:st,components:{App:o},template:"<App/>",created:function(){this.checkLogin()},watch:{$route:function(t,e){this.checkLogin()}},methods:{checkLogin:function(){this.getCookie("token")?this.$route.path==this.GLOBAL.routers.login?this.$router.push(this.GLOBAL.routers.projects):this.$router.push(this.$route.path):this.$router.push(this.GLOBAL.routers.login)}}})},rdV6:function(t,e){},tvR6:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.741085ec45e21cf22ea5.js.map
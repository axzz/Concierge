webpackJsonp([1],{NHnr:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("7+uW"),a=i("zL8q"),r=i.n(a),o=(i("tvR6"),{render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view",{attrs:{name:"nav"}}),this._v(" "),e("router-view",{attrs:{name:"content"}})],1)},staticRenderFns:[]}),n=i("VU/8")({name:"App",data:function(){return{}}},o,!1,null,null,null).exports,l=i("/ocq"),c="获取短信验证码",u="秒后重新获取",d="您输入的手机不是管理员，请到小程序进行注册。",p={data:function(){return{tel:"",code:"",telError:!1,numError:!1,countdownRange:60,counting:!1,activeName:"phoneLogin"}},computed:{codeButtonText:function(){return this.counting?""+this.countdownRange+u:""+c}},methods:{validate:function(){return/^1[34578][0-9]{9}$/.test(this.tel)},login:function(){var t=this;if(this.validate()&&6==this.code.length){var e={tel:this.tel,code:this.code};this.$http.post(this.GLOBAL.requestUrls.login,e).then(function(e){t.setCookie("token",e.headers.authorization,t.GLOBAL.expire),t.setCookie("name",e.data.name,1e3*t.GLOBAL.expire),t.$router.push(t.GLOBAL.routers.projects)}).catch(function(e){422===e.response.status&&(t.numError=!0)})}else this.validate()&&6==!this.code.length?this.numError=!0:this.validate()||6!=this.code.length?(this.telError=!0,this.numError=!0):this.telError=!0},countdown:function(){this.counting=!0,this._count()},getCode:function(){var t=this;if(this.telError=!this.validate(),!this.telError){var e={tel:this.tel};this.$http.post(this.GLOBAL.requestUrls.code,e).then(function(e){t.countdown()}).catch(function(e){422===e.response.status&&(t.telError=!0),403===e.response.status&&t.$message.error(d)})}},_count:function(){if(0===this.countdownRange)return this.counting=!1,void(this.countdownRange=60);this.countdownRange--,setTimeout(this._count,1e3)}}},h={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"login-com-container",staticStyle:{"background-image":"url('./static/images/login.jpg')"}},[i("el-card",{staticClass:"box-card"},[i("div",{staticClass:"login-title"},[i("span",{staticClass:"title-zn"},[t._v("预约管理系统")]),t._v(" "),i("span",{staticClass:"title-en"},[t._v("Reservation Management System")])]),t._v(" "),i("div",{staticClass:"login-content"},[i("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"手机号登录",name:"phoneLogin"}},[i("div",{staticClass:"input-container"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.tel,expression:"tel"}],staticClass:"login-input",attrs:{type:"text",placeholder:"请输入手机号码",maxlength:"11"},domProps:{value:t.tel},on:{input:function(e){e.target.composing||(t.tel=e.target.value)}}}),t._v(" "),i("div",{staticClass:"error-msg tel-error"},[i("span",{directives:[{name:"show",rawName:"v-show",value:t.telError,expression:"telError"}]},[t._v("请输入正确的手机号")])])]),t._v(" "),i("div",{staticClass:"input-wrapper"},[i("div",{staticClass:"input-msg-container"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.code,expression:"code"}],staticClass:"login-input message-input",attrs:{type:"number",placeholder:"请输入6位短信验证码"},domProps:{value:t.code},on:{input:function(e){e.target.composing||(t.code=e.target.value)}}})]),t._v(" "),i("el-button",{attrs:{type:"text",disabled:t.counting},on:{click:t.getCode}},[t._v("\n              "+t._s(t.codeButtonText)+"\n            ")]),t._v(" "),i("div",{staticClass:"error-msg code-error"},[i("span",{directives:[{name:"show",rawName:"v-show",value:t.numError,expression:"numError"}]},[t._v("请输入正确的短信验证码")])])],1),t._v(" "),i("el-button",{staticClass:"login-btn",attrs:{type:"primary",disabled:""==t.tel||""==t.code},on:{click:t.login}},[t._v("\n            登录\n          ")])],1),t._v(" "),i("el-tab-pane",{attrs:{label:"扫码注册",name:"codeLogin"}},[i("div",{staticClass:"code-img",staticStyle:{"background-image":"url('./static/images/register.jpg')"}}),t._v(" "),i("p",{staticClass:"code-tip"},[t._v("请用微信扫描二维码注册")])])],1)],1)])],1)},staticRenderFns:[]},m=i("VU/8")(p,h,!1,null,null,null).exports,v={props:{originUrl:{type:String,default:""},className:{type:String,default:""},imageWrapper:{type:String,default:""}},data:function(){return{imgClass:this.className,imgWrapperClass:this.imageWrapper}},computed:{fomatedUrl:function(){if(this.originUrl)return this.GLOBAL.server+this.originUrl}},methods:{handleOnload:function(){this.$emit("onLoad")}}},g={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{class:this.imgWrapperClass},[e("img",{class:this.imgClass,attrs:{src:this.fomatedUrl},on:{load:this.handleOnload}})])},staticRenderFns:[]},f=i("VU/8")(v,g,!1,null,null,null).exports,_={components:{"formated-image":f},props:{project:{type:Object,default:""}},data:function(){return{imageClass:"project-image",codeClass:"code"}},methods:{handleStopPropagation:function(t){t.stopPropagation()},editProject:function(){this.$router.push(this.GLOBAL.routers.projects_edit+this.project.id)},showDetail:function(){this.$router.push(this.GLOBAL.routers.reservations_details+this.project.id+"/"+this.project.name)}}},C={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"project card-item",on:{click:t.showDetail}},[i("el-card",{attrs:{"body-style":{padding:"0px"}}},[i("formated-image",{staticClass:"image-wrapper",attrs:{originUrl:t.project.image,className:t.imageClass}}),t._v(" "),i("div",{staticStyle:{padding:"10px"}},[i("div",{staticClass:"project-name"},[t._v(t._s(t.project.name))]),t._v(" "),i("div",{staticClass:"bottom bottom-flex"},["open"===t.project.state?i("span",{staticClass:"project-state"},[t._v("开启")]):i("span",{staticClass:"project-state"},[t._v("关闭")]),t._v(" "),i("span",{staticClass:"project-share",on:{click:function(e){return e.stopPropagation(),t.handleStopPropagation(e)}}},[i("i",{staticClass:"el-icon-edit oprerate-icon",on:{click:function(e){return e.stopPropagation(),t.editProject(e)}}}),t._v(" "),i("el-dropdown",{attrs:{trigger:"click"}},[i("span",{staticClass:"el-dropdown-link"},[i("i",{staticClass:"el-icon-share oprerate-icon"})]),t._v(" "),i("el-dropdown-menu",{staticClass:"dropdown-container",attrs:{slot:"dropdown"},slot:"dropdown"},[i("div",{staticClass:"text"},[i("span",{staticClass:"icon",staticStyle:{"background-image":"url('./static/images/wechat.png')"}}),t._v(" "),i("span",[t._v("微信扫一扫")])]),t._v(" "),i("formated-image",{staticClass:"code-wrapper",attrs:{originUrl:t.project.wxcode,className:t.codeClass}})],1)],1)],1)])])],1)],1)},staticRenderFns:[]},k="请输入分类名称",b="请选择预约项目",w={components:{"project-entrance":i("VU/8")(_,C,!1,null,null,null).exports,"formated-image":f},data:function(){return{projectsList:[],allProjects:[],groupsList:[],checkedGroupName:"",checkedGroupId:0,checkedGroupIndex:0,checkedGroupWxcode:"",paginationCount:0,pageSize:12,currentPage:1,groupDialogVisible:!1,deleteDialogVisible:!1,groupShowAll:!1,groupEditState:!1,searchState:!1,codeClass:"code",group:{name:"",projects:[]},searchContent:""}},created:function(){this.requestAllProjects(),this.requestProjects()},methods:{newProject:function(){this.$router.push(this.GLOBAL.routers.projects_new)},handleDropdownCommand:function(t){if("newProject"===t)this.newProject();else{if("newGroup"!==t)return;this.group.name="",this.group.projects=[],this.groupDialogVisible=!0}},handleSearch:function(){this.checkedGroupId=0,this.checkedGroupIndex=0,this.searchState=!0,this.searchParam=this.searchContent,this.searchContent?this.goPage(1,this.pageSize,this.checkedGroupId,this.searchParam):this.handleClear()},handleClear:function(){this.searchState=!1,this.searchParam=this.searchContent,this.changeGroup(0)},refreshGroup:function(){var t=this;this.$http({method:"get",url:this.GLOBAL.requestUrls.projects,headers:{Authorization:this.getCookie("token")},params:{group:0===this.checkedGroupId?"":this.checkedGroupId,size:this.pageSize}}).then(function(e){t.projectsList=e.data.projects,t.paginationCount=e.data.count,t.setCookie("token",e.headers.authorization,t.GLOBAL.expire)})},getGroupInfo:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.group+(0===this.checkedGroupId?"":this.checkedGroupId),this.getRequestConfig()).then(function(e){t.editGroupName=e.data.name,t.editGroupProjects=e.data.projects})},changeGroup:function(t){this.checkedGroupIndex=t,this.checkedGroupId=this.groupsList[t].id,this.checkedGroupName=this.groupsList[t].name,this.checkedGroupWxcode=this.groupsList[t].wxcode,this.currentPage=1,this.refreshGroup(),this.getGroupInfo()},changeDisplay:function(){this.groupShowAll=!this.groupShowAll},handleCurrentChange:function(t){this.goPage(t,this.pageSize,this.checkedGroupId,this.searchParam)},handleSizeChange:function(t){this.pageSize=t,this.goPage(1,t,this.checkedGroupId,this.searchParam)},goPage:function(t,e,i,s){var a=this;this.$http({method:"get",url:this.GLOBAL.requestUrls.projects,headers:{Authorization:this.getCookie("token")},params:{page:t,size:e,group:0===i?"":i,search:s}}).then(function(t){a.projectsList=t.data.projects,a.paginationCount=t.data.count,a.setCookie("token",t.headers.authorization,a.GLOBAL.expire)}).catch(function(t){a.handleHttpError(t)})},requestCreateGroup:function(){var t=this;this.$http({method:"post",url:this.GLOBAL.requestUrls.groups,headers:{Authorization:this.getCookie("token")},data:{name:this.group.name,projects:this.group.projects}}).then(function(e){t.requestGroups()})},requestEditGroup:function(){var t=this;this.$http({method:"put",url:this.GLOBAL.requestUrls.group+this.checkedGroupId,headers:{Authorization:this.getCookie("token")},data:{name:this.group.name,projects:this.group.projects}}).then(function(e){t.requestGroups(),t.refreshGroup(),t.getGroupInfo()})},createGroup:function(){this.group.name?this.group.projects.length?this.groupEditState?this.requestEditGroup():this.requestCreateGroup():this.$message.error(b):this.$message.error(k)},editGroup:function(){this.groupEditState=!0,this.group.name=this.editGroupName,this.group.projects=this.editGroupProjects,this.groupDialogVisible=!0},deleteGroup:function(){var t=this;this.$http({method:"delete",url:this.GLOBAL.requestUrls.group+this.checkedGroupId,headers:{Authorization:this.getCookie("token")}}).then(function(e){t.requestGroups(),t.changeGroup(0),t.deleteDialogVisible=!1})},requestProjects:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.projects,this.getRequestConfig()).then(function(e){t.projectsList=e.data.projects,t.paginationCount=e.data.count,t.setCookie("token",e.headers.authorization,t.GLOBAL.expire)}).catch(function(e){t.handleHttpError(e)})},requestAllProjects:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.all_projects,this.getRequestConfig()).then(function(e){t.groupFirstData={id:0,name:"全部",total:e.data.projects.length,wxcode:""},t.allProjects=e.data.projects,t.groupsList.push(t.groupFirstData),t.requestGroups(),t.setCookie("token",e.headers.authorization,t.GLOBAL.expire)})},requestGroups:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.groups,this.getRequestConfig()).then(function(e){t.groupsList=[],t.groupsList.push(t.groupFirstData),t.groupsList=t.groupsList.concat(e.data),t.checkedGroupName=t.groupsList[t.checkedGroupIndex].name,t.groupDialogVisible=!1})}}},L={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"admin-com-container"},[i("div",{staticClass:"admin-com-top"},[i("div",{staticClass:"created-search-space-between"},[t.searchState?i("span",{staticClass:"search-result-text"},[t._v("搜索结果")]):i("el-dropdown",{attrs:{"split-button":"",type:"primary",trigger:"click"},on:{click:t.newProject,command:t.handleDropdownCommand}},[i("span",{staticClass:"new-project-text"},[t._v("创建新项目")]),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"newProject"}},[t._v("创建新项目")]),t._v(" "),i("el-dropdown-item",{attrs:{command:"newGroup"}},[t._v("创建新分类")])],1)],1),t._v(" "),i("el-input",{staticClass:"search-input",attrs:{clearable:"",placeholder:"搜索预约项目名称","prefix-icon":"el-icon-search"},on:{clear:t.handleClear},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.handleSearch(e):null}},model:{value:t.searchContent,callback:function(e){t.searchContent=e},expression:"searchContent"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.searchState,expression:"!searchState"}],staticClass:"group-display",class:{display:t.groupShowAll,hidden:!t.groupShowAll}},[i("span",{staticClass:"control-icon",on:{click:t.changeDisplay}},[t.groupShowAll?i("i",{staticClass:"el-icon-arrow-down"}):i("i",{staticClass:"el-icon-arrow-right"})]),t._v(" "),t._m(0),t._v(" "),t._l(t.groupsList,function(e,s){return i("div",{staticClass:"group-item"},[i("span",{class:[t.checkedGroupIndex===s?"active":"","group-name"],on:{click:function(e){t.changeGroup(s)}}},[t._v(t._s(e.name))]),t._v(" "),i("span",{staticClass:"group-count"},[t._v(t._s(e.total))])])})],2),t._v(" "),i("el-dialog",{attrs:{title:t.groupEditState?"修改分类":"创建新分类",visible:t.groupDialogVisible,width:"600px"},on:{"update:visible":function(e){t.groupDialogVisible=e}}},[i("el-form",[i("el-form-item",[i("el-input",{attrs:{placeholder:"请输入分类名称"},model:{value:t.group.name,callback:function(e){t.$set(t.group,"name",e)},expression:"group.name"}})],1),t._v(" "),i("el-form-item",[i("div",{staticClass:"projects-wrapper"},[i("el-checkbox-group",{staticClass:"projects-checkbox-group",model:{value:t.group.projects,callback:function(e){t.$set(t.group,"projects",e)},expression:"group.projects"}},t._l(t.allProjects,function(e){return i("el-checkbox",{key:e.id,attrs:{label:e.id}},[t._v(t._s(e.name))])}))],1)])],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.groupDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.createGroup}},[t._v("确 定")])],1)],1)],1),t._v(" "),i("div",{staticClass:"admin-com-bottom"},[i("div",{directives:[{name:"show",rawName:"v-show",value:0!==t.checkedGroupId,expression:"checkedGroupId !== 0"}],staticClass:"group-wrapper"},[i("span",{staticClass:"group-name"},[t._v(t._s(t.checkedGroupName))]),t._v(" "),i("span",{staticClass:"group-operate-btn"},[i("i",{staticClass:"el-icon-edit",on:{click:t.editGroup}}),t._v(" "),i("el-dropdown",{attrs:{trigger:"click"}},[i("span",{staticClass:"el-dropdown-link"},[i("i",{staticClass:"el-icon-share"})]),t._v(" "),i("el-dropdown-menu",{staticClass:"dropdown-container",attrs:{slot:"dropdown"},slot:"dropdown"},[i("div",{staticClass:"text"},[i("span",{staticClass:"icon",staticStyle:{"background-image":"url('./static/images/wechat.png')"}}),t._v(" "),i("span",[t._v("微信扫一扫")])]),t._v(" "),i("formated-image",{staticClass:"code-wrapper",attrs:{originUrl:t.checkedGroupWxcode,className:t.codeClass}})],1)],1),t._v(" "),i("i",{staticClass:"el-icon-delete",on:{click:function(e){t.deleteDialogVisible=!0}}})],1),t._v(" "),i("el-dialog",{attrs:{title:"删除分类",visible:t.deleteDialogVisible,width:"600px"},on:{"update:visible":function(e){t.deleteDialogVisible=e}}},[i("div",[t._v('您确定要删除"'+t._s(t.checkedGroupName)+'"分类吗?')]),t._v(" "),i("div",[t._v("1、删除分类后该分类将不在分类列表中显示。")]),t._v(" "),i("div",[t._v("2、添加了该分类的所有预约项目都将搜索不到该分类。")]),t._v(" "),i("div",[t._v("请谨慎对待!")]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.deleteDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.deleteGroup}},[t._v("确 定")])],1)])],1),t._v(" "),i("div",{staticClass:"card-wrapper"},t._l(t.projectsList,function(t){return i("project-entrance",{key:t.id,attrs:{project:t}})})),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.projectsList.length,expression:"projectsList.length"}],staticClass:"pagination-wrapper"},[i("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":t.pageSize,"page-sizes":[4,8,12,16,20],layout:"total,sizes,prev, pager, next, jumper",total:t.paginationCount},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange,"update:currentPage":function(e){t.currentPage=e}}})],1)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",{staticClass:"group-title"},[this._v("分类:")])])}]},y=i("VU/8")(w,L,!1,null,null,null).exports,j={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"nav-com-container"},[i("span",{staticClass:"nav-title"},[t._v("预约系统")]),t._v(" "),i("div",{staticClass:"drop-wrapper"},[i("el-dropdown",{attrs:{trigger:"click"},on:{command:t.handleCommand}},[i("span",{staticClass:"el-dropdown-link nick-name"},[t._v("\n        "+t._s(t.nickName)+"\n        "),i("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"logout"}},[t._v("退出")])],1)],1)],1)])},staticRenderFns:[]},S=i("VU/8")({data:function(){return{nickName:"管理员"}},created:function(){this.nickName=this.getCookie("name")},methods:{handleCommand:function(t){"logout"===t&&this.logout()},logout:function(){this.delCookie("token"),this.$router.push(this.GLOBAL.routers.login)}}},j,!1,null,null,null).exports,x=i("mvHQ"),A=i.n(x),G=i("gRE1"),$=i.n(G),T=i("fZjL"),D=i.n(T),V={components:{"formated-image":f},props:{image:{type:String,default:""}},data:function(){return{coverModalVisible:!1,currentImage:this.image,defaultImageList:[],classNames:{form_cover:"form-cover",default_cover:"img",image_wrapper:"item-img-wrapper",cover_wrapper:"cover-wrapper"}}},created:function(){this.getCovers()},methods:{getCovers:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.covers).then(function(e){t.defaultImageList=e.data.images,""===t.currentImage&&(t.currentImage=t.defaultImageList[0])})},handleImageOnload:function(t){this.loading&&this.loading.close()},handleUpload:function(){var t=this;this.loading=this.$loading({target:".img-wrapper",background:"#f1f1f1"}),lrz(this.$refs.uploadImageRef.files[0]).then(function(e){var i=new FormData;i.append("image",e.formData.get("file")),t.$http.post(t.GLOBAL.requestUrls.image,i,t.getRequestConfig()).then(function(e){t.currentImage=e.data.image,t.setCookie("token",e.headers.authorization,t.GLOBAL.expire)}).catch(function(e){t.handleHttpError(e)})}),this.coverModalVisible=!1},changeCover:function(t){this.currentImage=this.defaultImageList[t],this.coverModalVisible=!1},updateValue:function(t){this.currentImage=t},getData:function(){return this.currentImage}}},I={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"img-wrapper"},[i("formated-image",{attrs:{originUrl:t.currentImage,className:t.classNames.form_cover,imageWrapper:t.classNames.cover_wrapper},on:{onLoad:t.handleImageOnload}}),t._v(" "),i("div",{staticClass:"change-cover-btn"},[i("el-button",{staticClass:"change-cover",attrs:{type:"primary"},on:{click:function(e){t.coverModalVisible=!0}}},[t._v("更换封面")]),t._v(" "),i("el-dialog",{attrs:{title:"更换封面",visible:t.coverModalVisible,width:"858px"},on:{"update:visible":function(e){t.coverModalVisible=e}}},[i("div",{staticClass:"imgs-list"},[i("div",{staticClass:"upload imgs-item"},[i("label",{attrs:{for:"file_input"}},[i("i",{staticClass:"el-icon-upload"}),t._v(" "),i("div",[t._v("上传图片")])]),t._v(" "),i("input",{ref:"uploadImageRef",attrs:{type:"file",id:"file_input",accept:"image/*"},on:{change:t.handleUpload}})]),t._v(" "),t._l(t.defaultImageList,function(e,s){return i("div",{staticClass:"imgs-item",on:{click:function(e){t.changeCover(s)}}},[i("formated-image",{attrs:{originUrl:e,className:t.classNames.default_cover,imageWrapper:t.classNames.image_wrapper}})],1)})],2)])],1)],1)},staticRenderFns:[]},O=i("VU/8")(V,I,!1,null,null,null).exports,B={props:{address:{type:String,default:""},latitude:{type:Number,default:0},longitude:{type:Number,default:0}},data:function(){return{currentAddress:this.address,currentLatitude:this.latitude,currentLongitude:this.longitude,isShowMap:!1,isShowPanel:!1,isInitMap:!0,markers:[]}},methods:{handleFocus:function(){this.isShowMap=!0,this.$route.params.id&&this.isInitMap?(this.mapInit(),this.isInitMap=!1):this.currentLatitude&&this.currentLongitude&&this.currentAddress?this.renderOriginLocation():this.currentAddress||(this.mapInit(),this.currentLatitude=0,this.currentLongitude=0)},mapInit:function(){this.map=new AMap.Map("map-container",{zoom:12}),this.geocoderInit(),this.placeSearchInit(),this.infoWindowInit(),this.mapClick(),this.renderOriginLocation()},geocoderInit:function(){var t=this;AMap.plugin("AMap.Geocoder",function(){t.geocoder=new AMap.Geocoder({radius:1e3,extensions:"all"}),t.map.addControl(t.geocoder)})},placeSearchInit:function(){var t=this;AMap.service(["AMap.PlaceSearch"],function(){t.placeSearch=new AMap.PlaceSearch({pageSize:5,pageIndex:1,city:"028",map:t.map,panel:"map-panel",renderStyle:"default"})})},infoWindowInit:function(){var t=this;AMap.plugin("AMap.InfoWindow",function(){t.infoWindow=new AMap.InfoWindow({content:"",autoMove:!0,closeWhenClickMap:!0})})},renderOriginLocation:function(){if(this.currentLatitude&&this.currentLongitude&&this.currentAddress){var t=new AMap.Marker({position:[this.currentLongitude,this.currentLatitude]});t.setMap(this.map),this.map.setZoom(14),this.map.setCenter([this.currentLongitude,this.currentLatitude]),this.markers.push(t),this.renderInfoWindow(this.currentLongitude,this.currentLatitude,t)}},mapClick:function(){var t=this;this.map.on("click",function(e){var i=e.lnglat.getLng(),s=e.lnglat.getLat();t.map.remove(t.markers),t.updatePosition(i,s),t.setMarker(i,s),t.placeSearch.clear()}),this.placeSearch.on("listElementClick",function(e){t.updateValue(t.getPositionInfo(e))}),this.placeSearch.on("markerClick",function(e){t.updateValue(t.getPositionInfo(e))})},getPositionInfo:function(t){return{latitude:t.data.location.lat,longitude:t.data.location.lng,address:t.data.cityname+t.data.adname+t.data.address}},setMarker:function(t,e){var i=new AMap.Marker({position:[t,e]});i.setMap(this.map),this.map.setZoom(14),this.map.setCenter([t,e]),this.markers.push(i),this.renderInfoWindow(t,e,i)},renderInfoWindow:function(t,e,i){var s=this;this.geocoder.getAddress([t,e],function(a,r){"complete"===a&&"OK"===r.info&&(s.currentAddress=r.regeocode.formattedAddress,s.infoWindow.setContent("<div>"+r.regeocode.formattedAddress+"</div"),s.infoWindow.open(s.map,[t,e]),i.on("click",function(){s.infoWindow.open(s.map,[t,e]),s.updatePosition(t,e)}))})},search:function(){this.isShowMap&&(this.isShowPanel=!0,this.map.remove(this.markers),this.infoWindow.close(),this.placeSearch.search(this.currentAddress))},closeMap:function(){this.isShowPanel=!1,this.placeSearch.clear(),this.isShowMap=!1},updateValue:function(t){this.currentAddress=t.address,this.currentLatitude=t.latitude,this.currentLongitude=t.longitude},updatePosition:function(t,e){this.currentLatitude=e,this.currentLongitude=t},getData:function(){return{address:this.currentAddress,latitude:this.currentLatitude,longitude:this.currentLongitude}}}},P={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"form-address"},[i("span",{staticClass:"address-text"},[t._v("详细地址: ")]),t._v(" "),i("el-input",{staticClass:"address-input",on:{focus:t.handleFocus},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.search(e):null}},model:{value:t.currentAddress,callback:function(e){t.currentAddress=e},expression:"currentAddress"}},[i("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.search},slot:"append"})],1)],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowMap,expression:"isShowMap"}],attrs:{id:"map-container"}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowPanel,expression:"isShowPanel"}],attrs:{id:"map-panel"}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowMap,expression:"isShowMap"}],staticClass:"map-close",on:{click:t.closeMap}},[i("i",{staticClass:"el-icon-close"})])])},staticRenderFns:[]},R=i("VU/8")(B,P,!1,null,null,null).exports,E={Mon:"周一",Tues:"周二",Wed:"周三",Thur:"周四",Fri:"周五",Sat:"周六",Sun:"周日",Holiday:"法定节假日"},N="请填写时间段和重复日期",q="已存在相同时间段",M="请输入正确的时间段",U=[{value:"Mon",label:"周一"},{value:"Tues",label:"周二"},{value:"Wed",label:"周三"},{value:"Thur",label:"周四"},{value:"Fri",label:"周五"},{value:"Sat",label:"周六"},{value:"Sun",label:"周日"},{value:"Holiday",label:"法定节假日"}],z={props:{timeState:{type:Object,default:{normal:[{time:"09:00-10:00",limit:10,weekday:["Mon","Tues","Wed","Thur","Fri"]}],special:[]}}},data:function(){return{weekdays:U,currentTimeState:this.timeState,settingDialogVisible:!1,isShowNormal:!0,weekdayValue:["Mon","Tues","Wed","Thur","Fri"],limitValue:"",startTime:"",endTime:"",editStatus:!1,editIndex:null}},computed:{formatedTimeState:function(){return this.currentTimeState.normal.map(function(t){var e=t.weekday.map(function(t){return E[t]});return{time:t.time,limit:t.limit,weekday:e}})}},methods:{newItem:function(){this.settingDialogVisible=!0,this.startTime="09:00",this.endTime="10:00",this.weekdayValue=["Mon","Tues","Wed","Thur","Fri"],this.limitValue=" "},validateEmpty:function(){return this.error={},this.startTime&&this.endTime&&this.weekdayValue.length||(this.error.empty_tip=N),0==D()(this.error).length},validateNewTime:function(t){var e=this;return this.error={},this.currentTimeState.normal.forEach(function(i){i.time==t&&(e.error.repeat_tip=q)}),0==D()(this.error).length},validateEditTime:function(t){var e=this;return this.error={},this.currentTimeState.normal.forEach(function(i,s){s!==e.editIndex&&i.time===t&&(e.error.repeat_tip=q)}),0==D()(this.error).length},validateTime:function(t,e){return this.error={},t>=e&&(this.error.invalid_tip=M),0==D()(this.error).length},compeleteSetting:function(){var t,e={},i=this.startTime+"-"+this.endTime,s=this.weekdayValue;t=" "===this.limitValue||""===this.limitValue?null:Math.abs(parseInt(this.limitValue)),this.validateEmpty()?(e={time:i,limit:t,weekday:s},this.validateTime(this.startTime,this.endTime)?this.editStatus?this.validateEditTime(i)?(this.currentTimeState.normal.splice(this.editIndex,1,e),this.settingDialogVisible=!1):this.$message.error(this.error.repeat_tip):this.validateNewTime(i)?(this.currentTimeState.normal.push(e),this.settingDialogVisible=!1):this.$message.error(this.error.repeat_tip):(this.settingDialogVisible=!0,this.$message.error(this.error.invalid_tip))):(this.settingDialogVisible=!0,this.$message.error(this.error.empty_tip))},deleteItem:function(t){this.currentTimeState.normal.splice(t,1)},editItem:function(t){this.settingDialogVisible=!0;var e=this.currentTimeState.normal[t];this.startTime=e.time.split("-")[0],this.endTime=e.time.split("-")[1],this.weekdayValue=e.weekday,this.limitValue=null===e.limit?" ":e.limit,this.editStatus=!0,this.editIndex=t},updateValue:function(t){this.currentTimeState=t},getData:function(){return this.currentTimeState}}},F={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"form-settime-wrapper"},[i("el-radio-group",{staticClass:"setting-pattern",model:{value:t.isShowNormal,callback:function(e){t.isShowNormal=e},expression:"isShowNormal"}},[i("el-radio-button",{attrs:{label:!0}},[t._v("常规设置")]),t._v(" "),i("el-radio-button",{attrs:{label:!1}},[t._v("特殊设置")])],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowNormal,expression:"isShowNormal"}],staticClass:"normal-setting-wrapper"},[i("div",{staticClass:"normal-setting-item-wrapper"},t._l(t.formatedTimeState,function(e,s){return i("div",{staticClass:"normal-setting-item"},[i("span",{staticClass:"item-left"},[t._v(t._s(e.time))]),t._v(" "),i("div",{staticClass:"item-right"},[i("div",{staticClass:"weekday-container",on:{click:function(e){t.editItem(s)}}},t._l(e.weekday,function(e){return i("span",{staticClass:"weekday"},[t._v(t._s(e))])})),t._v(" "),null===e.limit?i("span",{staticClass:"number"},[t._v("名额不限制")]):i("span",{staticClass:"number"},[t._v("名额"+t._s(e.limit)+"人")])]),t._v(" "),i("span",{staticClass:"operate-btn"},[i("i",{staticClass:"el-icon-circle-plus-outline",on:{click:t.newItem}}),t._v(" "),i("i",{directives:[{name:"show",rawName:"v-show",value:t.formatedTimeState.length>1,expression:"formatedTimeState.length > 1"}],staticClass:"el-icon-remove-outline",on:{click:function(e){t.deleteItem(s)}}})])])})),t._v(" "),i("el-dialog",{attrs:{title:"预约时间设置",visible:t.settingDialogVisible,width:"600px",center:""},on:{"update:visible":function(e){t.settingDialogVisible=e},close:function(e){t.editStatus=!1}}},[i("div",{staticClass:"setting-content"},[i("div",{staticClass:"fields"},[i("span",{staticClass:"text"},[t._v("时间段: ")]),t._v(" "),i("el-time-picker",{attrs:{placeholder:"开始时间","value-format":"HH:mm",format:"HH:mm"},model:{value:t.startTime,callback:function(e){t.startTime=e},expression:"startTime"}}),t._v(" "),i("span",{staticClass:"middle-text"},[t._v("至")]),t._v(" "),i("el-time-picker",{attrs:{placeholder:"结束时间","value-format":"HH:mm",format:"HH:mm"},model:{value:t.endTime,callback:function(e){t.endTime=e},expression:"endTime"}})],1),t._v(" "),i("div",{staticClass:"fields"},[i("span",{staticClass:"text"},[t._v("重复:")]),t._v(" "),i("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.weekdayValue,callback:function(e){t.weekdayValue=e},expression:"weekdayValue"}},t._l(t.weekdays,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),i("div",{staticClass:"fields"},[i("span",{staticClass:"text"},[t._v("名额限制: ")]),t._v(" "),i("el-input",{staticClass:"count-input",attrs:{placeholder:"不填写则默认为无限制",type:"number"},model:{value:t.limitValue,callback:function(e){t.limitValue=e},expression:"limitValue"}})],1)]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.settingDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.compeleteSetting}},[t._v("确 定")])],1)])],1)],1)},staticRenderFns:[]},W="拼命加载中",H="预约项目名称不能为空",Z="请按要求填写规范的数据",J=[{value:"day",label:"天"},{value:"hour",label:"小时"},{value:"minute",label:"分钟"}],K=[{value:"public",label:"公开项目（任何人可在预约小程序中访问它，仅管理员可以编辑项目）"},{value:"private",label:"非公开项目（仅可通过微信分享（项目和分类）的二维码查看该项目，仅管理员可以编辑项目）"}],Q={components:{"cover-picker":O,"address-picker":R,"time-setter":i("VU/8")(z,F,!1,null,null,null).exports},data:function(){return{form:{image:"",name:"",description:"",address:"",latitude:0,longitude:0,check_mode:"auto",authority:"public",time_state:{normal:[{time:"09:00-10:00",limit:10,weekday:["Mon","Tues","Wed","Thur","Fri"]}],special:[]},multi_time:!1,date_display:7},reservationLimit:{reservation_limit:!1,reservation_per_user:1},aheadTime:{ahead_time:"",time_select:"day"},selectOptions:J,authorityOptions:K,submitButtonDisabled:!1}},created:function(){var t=this;if(this.$route.params.id){var e=this.$loading({text:W,spinner:"el-icon-loading",customClass:"loading-style"});this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id,this.getRequestConfig()).then(function(i){t.form=i.data,t.updateProps(t.form),t.updateForm(t.form),e.close()}).catch(function(i){e.close(),t.handleHttpError(i)})}},computed:{reservationLimitValid:function(){return"NaN"!==parseFloat(this.reservationLimit.reservation_per_user).toString()&&(!(this.reservationLimit.reservation_per_user<=0)&&this.reservationLimit.reservation_per_user%1==0)},displayDayValid:function(){return"NaN"!==parseFloat(this.form.date_display).toString()&&(!(this.form.date_display>7||this.form.date_display<1)&&this.form.date_display%1==0)},aheadTimeValid:function(){return""===this.aheadTime.ahead_time||"NaN"!==parseFloat(this.aheadTime.ahead_time).toString()&&(!(this.aheadTime.ahead_time<=0)&&this.aheadTime.ahead_time%1==0)}},methods:{updateProps:function(t){var e={};e.address=t.address,e.latitude=t.latitude,e.longitude=t.longitude,this.$refs.coverPickerRef.updateValue(t.image),this.$refs.addressPickerRef.updateValue(e),this.$refs.timeSetterRef.updateValue(t.time_state)},updateForm:function(t){t.reservation_per_user&&(this.reservationLimit.reservation_limit=!0,this.reservationLimit.reservation_per_user=t.reservation_per_user),this.aheadTime.time_select=D()(t.ahead_time)[0],this.aheadTime.ahead_time=$()(t.ahead_time)[0]?Number($()(t.ahead_time)[0]):""},getComponentsData:function(){this.form.image=this.$refs.coverPickerRef.getData(),this.form.time_state=this.$refs.timeSetterRef.getData();var t=this.$refs.addressPickerRef.getData();this.form.address=t.address,this.form.latitude=t.latitude,this.form.longitude=t.longitude},getFormData:function(){var t=this;this.getComponentsData();var e=new FormData;return["name","description","address","latitude","longitude","check_mode","authority","image","multi_time","date_display"].forEach(function(i){e.append(i,t.form[i])}),e.append("time_state",A()(this.form.time_state)),this.reservationLimit.reservation_limit&&e.append("reservation_per_user",this.reservationLimit.reservation_per_user),e.append("ahead_time",A()(this.getAheadTime())),e},getAheadTime:function(){var t={};return"day"===this.aheadTime.time_select?t.day=String(this.aheadTime.ahead_time):"hour"===this.aheadTime.time_select?t.hour=String(this.aheadTime.ahead_time):"minute"===this.aheadTime.time_select&&(t.minute=String(this.aheadTime.ahead_time)),t},submitForm:function(){var t=this,e=this.getFormData();this.form.name?this.reservationLimitValid&&this.aheadTimeValid&&this.displayDayValid?(this.submitButtonDisabled=!0,this.$route.params.id?this.$http.put(this.GLOBAL.requestUrls.project+this.$route.params.id,e,this.getRequestConfig()).then(function(e){t.setCookie("token",e.headers.authorization,t.GLOBAL.expire),t.submitButtonDisabled=!1,t.$router.push(t.GLOBAL.routers.projects),t.$message.success("修改"+t.form.name+"预约项目成功")}).catch(function(e){t.submitButtonDisabled=!1,t.handleHttpError(e)}):this.$http.post(this.GLOBAL.requestUrls.projects,e,this.getRequestConfig()).then(function(e){t.setCookie("token",e.headers.authorization,t.GLOBAL.expire),t.$router.push(t.GLOBAL.routers.projects),t.submitButtonDisabled=!1,t.$message.success("添加"+t.form.name+"预约项目成功")}).catch(function(e){t.submitButtonDisabled=!1,t.handleHttpError(e)})):this.$message.error(Z):this.$message.error(H)}}},X={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"form-com-container"},[i("div",{staticClass:"form-wrapper"},[i("div",{staticClass:"return-to-prev"},[i("router-link",{attrs:{to:"/admin/projects"}},[i("i",{staticClass:"el-icon-back"})]),t._v(" "),this.$route.params.id?i("span",[t._v("修改预约项目")]):i("span",[t._v("创建预约项目")])],1),t._v(" "),i("el-form",{ref:"form",attrs:{model:t.form}},[i("el-form-item",[i("cover-picker",{ref:"coverPickerRef",attrs:{image:t.form.image}})],1),t._v(" "),i("el-form-item",[i("div",{staticClass:"title-wrapper"},[i("el-input",{attrs:{placeholder:"请输入预约项目名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)]),t._v(" "),i("el-form-item",[i("div",{staticClass:"desc-wrapper"},[i("el-input",{attrs:{type:"textarea",rows:5,placeholder:"预约详情介绍或预约注意事项"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)]),t._v(" "),i("el-form-item",[i("address-picker",{ref:"addressPickerRef",attrs:{address:t.form.address,latitude:t.form.latitude,longitude:t.form.longitude}})],1),t._v(" "),i("el-form-item",[i("div",{staticClass:"form-check"},[i("span",{staticClass:"form-item-text"},[t._v("审核模式: ")]),t._v(" "),i("el-radio",{attrs:{label:"auto"},model:{value:t.form.check_mode,callback:function(e){t.$set(t.form,"check_mode",e)},expression:"form.check_mode"}},[t._v("自动审核")]),t._v(" "),i("el-radio",{attrs:{label:"manual"},model:{value:t.form.check_mode,callback:function(e){t.$set(t.form,"check_mode",e)},expression:"form.check_mode"}},[t._v("人工审核")])],1)]),t._v(" "),i("el-form-item",[i("div",{staticClass:"form-authority"},[i("span",{staticClass:"form-item-text"},[t._v("项目公开性: ")]),t._v(" "),i("el-select",{model:{value:t.form.authority,callback:function(e){t.$set(t.form,"authority",e)},expression:"form.authority"}},t._l(t.authorityOptions,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)]),t._v(" "),i("el-form-item",[i("div",{staticClass:"form-time-period-select"},[i("span",{staticClass:"form-item-text"},[t._v("预约时间设置:")]),t._v(" "),i("el-radio-group",{model:{value:t.form.multi_time,callback:function(e){t.$set(t.form,"multi_time",e)},expression:"form.multi_time"}},[i("el-radio",{attrs:{label:!1}},[t._v("预约单时段")]),t._v(" "),i("el-radio",{attrs:{label:!0}},[t._v("预约多时段")])],1)],1)]),t._v(" "),i("el-form-item",[i("time-setter",{ref:"timeSetterRef",attrs:{timeState:t.form.time_state}})],1),t._v(" "),i("el-form-item",[i("div",{staticClass:"form-reservation-limit"},[i("span",{staticClass:"form-item-text"},[t._v("单人预约上限")]),t._v(" "),i("div",{staticClass:"limit-control"},[i("el-switch",{attrs:{"active-color":"#409EFF","inactive-color":"#909997"},model:{value:t.reservationLimit.reservation_limit,callback:function(e){t.$set(t.reservationLimit,"reservation_limit",e)},expression:"reservationLimit.reservation_limit"}}),t._v(" "),t.reservationLimit.reservation_limit?i("div",{staticClass:"limit-input"},[i("span",{staticClass:"form-item-text"},[t._v("每人可预约")]),t._v(" "),i("el-input",{model:{value:t.reservationLimit.reservation_per_user,callback:function(e){t.$set(t.reservationLimit,"reservation_per_user",e)},expression:"reservationLimit.reservation_per_user"}},[i("template",{slot:"append"},[t._v("次")])],2)],1):t._e()],1),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.reservationLimitValid,expression:"!reservationLimitValid"}],staticClass:"error-tip"},[t._v("请填写大于0的整数")])])]),t._v(" "),i("el-form-item",[i("div",{staticClass:"form-day-display"},[i("span",{staticClass:"form-item-text"},[i("span",[t._v("预约期限")]),t._v(" "),i("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[i("div",{attrs:{slot:"content"},slot:"content"},[t._v("即用户可预约未来多少天内的项目，最大可设置为7天，1天内指的是当天，以此推算。")]),t._v(" "),i("i",{staticClass:"el-icon-info"})])],1),t._v(" "),i("el-input",{attrs:{placeholder:"请输入1-7之间的整数"},model:{value:t.form.date_display,callback:function(e){t.$set(t.form,"date_display",e)},expression:"form.date_display"}},[i("template",{slot:"append"},[t._v("天内")])],2),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.displayDayValid,expression:"!displayDayValid"}],staticClass:"error-tip"},[t._v("请填写1-7之间的整数")])],1)]),t._v(" "),i("el-form-item",[i("div",{staticClass:"form-ahead-time"},[i("span",{staticClass:"form-item-text"},[t._v("预约至少提前")]),t._v(" "),i("el-input",{staticClass:"ahead-time-input",attrs:{placeholder:"如不填写则默认可从当天开始预约"},model:{value:t.aheadTime.ahead_time,callback:function(e){t.$set(t.aheadTime,"ahead_time",e)},expression:"aheadTime.ahead_time"}},[i("template",{slot:"append"},[i("el-select",{staticClass:"ahead-time-select",model:{value:t.aheadTime.time_select,callback:function(e){t.$set(t.aheadTime,"time_select",e)},expression:"aheadTime.time_select"}},t._l(t.selectOptions,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)],2),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:!t.aheadTimeValid,expression:"!aheadTimeValid"}],staticClass:"error-tip"},[t._v("请填写大于0的整数或不填写")])],1)])],1),t._v(" "),i("div",{staticClass:"form-btn"},[i("el-button",[i("router-link",{attrs:{to:"/admin/projects"}},[t._v("取消")])],1),t._v(" "),i("el-button",{attrs:{type:"primary",disabled:t.submitButtonDisabled},on:{click:t.submitForm}},[t._v("确定")])],1)],1)])},staticRenderFns:[]},Y=i("VU/8")(Q,X,!1,null,null,null).exports,tt={success:"已成功",wait:"待审核",cancelled:"已取消",checked:"已核销",overtime:"已过期"},et=[{value:"",label:"全部"},{value:"wait",label:tt.wait},{value:"success",label:tt.success},{value:"cancelled",label:tt.cancelled},{value:"checked",label:tt.checked},{value:"overtime",label:tt.overtime}],it="取消预约",st="核销预约",at="通过预约",rt="拼命加载中",ot={"已成功":it,"待审核":it},nt={"已成功":st,"待审核":at},lt={data:function(){return{reservations:[],totalReservations:0,projectState:"",projectAuthority:"",reservationsDate:[],reservationsTel:"",reservationsState:"",reservationsStateOptions:et,processDialogVisible:!1,stateDialogVisible:!1,confirmButtonDisabled:!1,modalTitle:"",operateRemark:"",stateCountObj:{}}},computed:{formatedReservations:function(){return this.reservations.map(function(t){return tt[t.state]&&(t.state=tt[t.state]),t})}},created:function(){var t=this.$loading({text:rt,spinner:"el-icon-loading",customClass:"loading-style"});this.getProjectState(t),this.getReservations(),this.getStateCount()},methods:{search:function(){this.filter(1)},filter:function(t){var e=this;this.$http({method:"get",url:this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations",headers:{Authorization:this.getCookie("token")},params:{tel:this.reservationsTel,date_to:this.reservationsDate.length?this.reservationsDate[1]:"",date_from:this.reservationsDate.length?this.reservationsDate[0]:"",state:this.reservationsState,page:t}}).then(function(t){e.reservations=t.data.reservations,e.totalReservations=t.data.count}).catch(function(t){e.handleHttpError(t)})},dismiss:function(t,e){this.reservationsIndex=t,this.modalTitle=ot[e],this.processDialogVisible=!0},allow:function(t,e){this.reservationsIndex=t,this.modalTitle=nt[e],this.processDialogVisible=!0},handleAllow:function(t,e){var i=this;this.processDialogVisible&&(this.confirmButtonDisabled=!0,this.$http({method:"post",url:this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations/"+this.reservations[this.reservationsIndex].id+t,headers:{Authorization:this.getCookie("token")}}).then(function(t){i.reservations[i.reservationsIndex].state=tt[e],i.getStateCount(),i.processDialogVisible=!1,i.confirmButtonDisabled=!1}).catch(function(t){i.confirmButtonDisabled=!1,i.handleHttpError(t)}))},handleDismiss:function(t,e){var i=this;this.processDialogVisible&&(this.confirmButtonDisabled=!0,this.$http({method:"post",url:this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations/"+this.reservations[this.reservationsIndex].id+t,headers:{Authorization:this.getCookie("token")},data:{remark:this.operateRemark}}).then(function(t){i.reservations[i.reservationsIndex].state=tt[e],i.reservations[i.reservationsIndex].remark=i.operateRemark,i.operateRemark="",i.getStateCount(),i.processDialogVisible=!1,i.confirmButtonDisabled=!1}).catch(function(t){i.confirmButtonDisabled=!1,i.handleHttpError(t)}))},confirm:function(){this.modalTitle===it?this.handleDismiss("/cancel","cancelled"):this.modalTitle===st?this.handleAllow("/check","checked"):this.modalTitle===at&&this.handleAllow("/pass","success")},handleCurrentChange:function(t){this.filter(t)},changeState:function(t){t?this.openProject():(this.projectState=!0,this.stateDialogVisible=!0)},changeAuthority:function(t){t?this.requestChangeAuthority("public"):this.requestChangeAuthority("private")},requestChangeAuthority:function(t){var e=this;this.$http({method:"patch",url:this.GLOBAL.requestUrls.authority,headers:{Authorization:this.getCookie("token")},data:{id:this.$route.params.id,authority:t}}).then(function(t){e.setCookie("token",t.headers.authorization,e.GLOBAL.expire)})},closeProject:function(){var t=this;this.stateDialogVisible&&(this.confirmButtonDisabled=!0,this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id+"/pause",this.getRequestConfig()).then(function(e){t.getReservations(),t.getStateCount(),t.projectState=!1,t.stateDialogVisible=!1,t.confirmButtonDisabled=!1}).catch(function(e){t.confirmButtonDisabled=!1,t.handleHttpError(e)}))},openProject:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id+"/open",this.getRequestConfig()).then(function(t){}).catch(function(e){t.handleHttpError(e)})},getStateCount:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations/count",this.getRequestConfig()).then(function(e){t.stateCountObj=e.data}).catch(function(e){t.handleHttpError(e)})},getReservations:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations",this.getRequestConfig()).then(function(e){t.reservations=e.data.reservations,t.totalReservations=e.data.count}).catch(function(e){t.handleHttpError(e)})},getProjectState:function(t){var e=this;this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id,this.getRequestConfig()).then(function(i){"open"===i.data.state?e.projectState=!0:e.projectState=!1,"private"===i.data.authority?e.projectAuthority=!1:e.projectAuthority=!0,t.close()}).catch(function(i){t.close(),e.handleHttpError(i)})}}},ct={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"detail-com-container"},[i("div",{staticClass:"return-to-prev"},[i("router-link",{attrs:{to:"/admin/projects"}},[i("i",{staticClass:"el-icon-back"})]),t._v(" "),i("span",{staticClass:"reservation-name"},[t._v(t._s(this.$route.params.projectName)+"预约记录")]),t._v(" "),i("span",{staticClass:"project-state"},[t._v("开启预约")]),t._v(" "),i("el-switch",{attrs:{"active-color":"#409EFF","inactive-color":"#909997"},on:{change:t.changeState},model:{value:t.projectState,callback:function(e){t.projectState=e},expression:"projectState"}}),t._v(" "),i("span",{staticClass:"project-authority"},[t._v("项目公开性")]),t._v(" "),i("el-switch",{attrs:{"active-color":"#409EFF","inactive-color":"#909997"},on:{change:t.changeAuthority},model:{value:t.projectAuthority,callback:function(e){t.projectAuthority=e},expression:"projectAuthority"}}),t._v(" "),i("el-dialog",{attrs:{title:"确认关闭",visible:t.stateDialogVisible,width:"500px"},on:{"update:visible":function(e){t.stateDialogVisible=e}}},[i("span",[t._v("关闭项目后，该项目下的所有预约都会被自动取消，您确认要关闭么?")]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.stateDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary",disabled:t.confirmButtonDisabled},on:{click:t.closeProject}},[t._v("确 定")])],1)])],1),t._v(" "),i("div",{staticClass:"reservations-list"},[i("div",{staticClass:"reservations-search"},[i("el-date-picker",{staticClass:"date-picker",attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:t.reservationsDate,callback:function(e){t.reservationsDate=e},expression:"reservationsDate"}}),t._v(" "),i("div",{staticClass:"reservations-tel"},[i("span",[t._v("联系电话: ")]),t._v(" "),i("el-input",{staticClass:"tel-input",model:{value:t.reservationsTel,callback:function(e){t.reservationsTel=e},expression:"reservationsTel"}})],1),t._v(" "),i("div",{staticClass:"reservations-state"},[i("span",[t._v("预约状态: ")]),t._v(" "),i("el-select",{staticClass:"state-select",model:{value:t.reservationsState,callback:function(e){t.reservationsState=e},expression:"reservationsState"}},t._l(t.reservationsStateOptions,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),i("el-button",{staticClass:"search-btn",attrs:{type:"primary"},on:{click:t.search}},[t._v("查询")])],1),t._v(" "),i("div",{staticClass:"reservations-list-body"},[i("div",{staticClass:"list-wrapper"},[t._m(0),t._v(" "),t._l(t.formatedReservations,function(e,s){return i("div",{key:e.id,staticClass:"table-item"},[i("span",{staticClass:"name item"},[t._v(t._s(e.name))]),t._v(" "),i("span",{staticClass:"item"},[t._v(t._s(e.state))]),t._v(" "),i("span",{staticClass:"item"},[t._v(t._s(e.tel))]),t._v(" "),i("span",{staticClass:"date item"},[t._v(t._s(e.date))]),t._v(" "),i("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[i("div",{attrs:{slot:"content"},slot:"content"},t._l(e.time,function(e){return i("span",[t._v(t._s(e)),i("br")])})),t._v(" "),i("span",{staticClass:"time item"},t._l(e.time,function(e){return i("span",{staticClass:"time-cell"},[t._v(t._s(e))])}))]),t._v(" "),i("span",{staticClass:"remark item"},[t._v(t._s(e.remark))]),t._v(" "),"已成功"===e.state?i("span",{staticClass:"operate item"},[i("span",{staticClass:"operate-set",on:{click:function(i){t.allow(s,e.state)}}},[t._v("核销")]),t._v(" "),i("span",{staticClass:"operate-set",on:{click:function(i){t.dismiss(s,e.state)}}},[t._v("取消")])]):"待审核"===e.state?i("span",{staticClass:"operate item"},[i("span",{staticClass:"operate-set",on:{click:function(i){t.allow(s,e.state)}}},[t._v("通过")]),t._v(" "),i("span",{staticClass:"operate-set",on:{click:function(i){t.dismiss(s,e.state)}}},[t._v("取消")])]):i("span",{staticClass:"operate item"},[t._v("---")])],1)})],2),t._v(" "),i("el-dialog",{ref:"modalRef",attrs:{title:t.modalTitle,visible:t.processDialogVisible,width:"500px"},on:{"update:visible":function(e){t.processDialogVisible=e}}},["取消预约"===t.modalTitle?i("el-input",{staticClass:"border-bottom",attrs:{placeholder:"请输入处理意见"},model:{value:t.operateRemark,callback:function(e){t.operateRemark=e},expression:"operateRemark"}}):"核销预约"===t.modalTitle?i("span",[t._v("是否核销该预约?")]):i("span",[t._v("是否通过该预约?")]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.processDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary",disabled:t.confirmButtonDisabled},on:{click:t.confirm}},[t._v("确 定")])],1)],1),t._v(" "),i("div",{staticClass:"reservations-list-bottom"},[i("div",{staticClass:"state-count"},[i("span",[t._v("总计: "+t._s(t.stateCountObj.total))]),t._v(" "),i("span",[t._v("待审核: "+t._s(t.stateCountObj.wait))]),t._v(" "),i("span",[t._v("已成功: "+t._s(t.stateCountObj.success))]),t._v(" "),i("span",[t._v("已核销: "+t._s(t.stateCountObj.checked))]),t._v(" "),i("span",[t._v("已取消: "+t._s(t.stateCountObj.cancelled))]),t._v(" "),i("span",[t._v("已过期: "+t._s(t.stateCountObj.overtime))])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.reservations.length,expression:"reservations.length"}],staticClass:"pagination-wrapper"},[i("el-pagination",{attrs:{"page-size":10,layout:"prev, pager, next, jumper",total:t.totalReservations},on:{"current-change":t.handleCurrentChange}})],1)])],1)])])},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"table-item table-head"},[i("span",{staticClass:"item"},[t._v("姓名")]),t._v(" "),i("span",{staticClass:"item"},[t._v("预约状态")]),t._v(" "),i("span",{staticClass:"item"},[t._v("联系电话")]),t._v(" "),i("span",{staticClass:"date item"},[t._v("预约时间")]),t._v(" "),i("span",{staticClass:"time item"},[t._v("预约时间段")]),t._v(" "),i("span",{staticClass:"remark item"},[t._v("备注")]),t._v(" "),i("span",{staticClass:"operate item"},[t._v("操作")])])}]},ut=i("VU/8")(lt,ct,!1,null,null,null).exports;s.default.use(l.a);var dt=new l.a({routes:[{path:"/",components:{nav:S,content:y}},{path:"/login",components:{nav:"",content:m}},{path:"/admin/projects",components:{nav:S,content:y}},{path:"/admin/projects/new",components:{nav:S,content:Y}},{path:"/admin/projects/edit/:id",components:{nav:S,content:Y}},{path:"/admin/projects/reservation/:id/:projectName",components:{nav:S,content:ut}}],mode:"hash"}),pt=i("mtWM"),ht=i.n(pt),mt=i("Rf8U"),vt=i.n(mt),gt=(i("U7mS"),i("rdV6"),""),ft={server:gt,expire:1296e5,routers:{login:"/login",projects:"/admin/projects",projects_new:"/admin/projects/new",projects_edit:"/admin/projects/edit/",reservations_details:"/admin/projects/reservation/"},requestUrls:{code:gt+"/code",login:gt+"/login",projects:gt+"/projects",project:gt+"/projects/",covers:gt+"/covers",image:gt+"/image",all_projects:gt+"/all-projects",groups:gt+"/groups",group:gt+"/groups/",authority:gt+"/project/authority"},httpStateInfo:{invalid_token:"Invalid Token"}},_t=i("VU/8")(ft,null,!1,null,null,null).exports;function Ct(t){var e,i=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(i))?e[2]:null}function kt(t){var e=new Date;e.setTime(e.getTime()-1);var i=Ct(t);null!=i&&(document.cookie=t+"="+i+";expires="+e.toGMTString())}s.default.config.productionTip=!1,s.default.use(r.a),s.default.use(vt.a,ht.a),s.default.prototype.setCookie=function(t,e,i){var s=new Date;s.setTime(s.getTime()+i),document.cookie=t+"="+e+(null==i?"":";expires="+s.toGMTString())},s.default.prototype.getCookie=Ct,s.default.prototype.delCookie=kt,s.default.prototype.handleHttpError=function(t){401===t.response.status&&(t.response.data===_t.httpStateInfo.invalid_token?(kt("token"),dt.push(_t.routers.login),r.a.Message.error("登录已过期，请重新登录。")):dt.push(_t.routers.projects))},s.default.prototype.getRequestConfig=function(){return{headers:{Authorization:Ct("token")}}},s.default.prototype.GLOBAL=_t,new s.default({el:"#app",router:dt,components:{App:n},template:"<App/>",created:function(){this.checkLogin()},watch:{$route:function(t,e){this.checkLogin()}},methods:{checkLogin:function(){this.getCookie("token")?this.$route.path==this.GLOBAL.routers.login?this.$router.push(this.GLOBAL.routers.projects):this.$router.push(this.$route.path):this.$router.push(this.GLOBAL.routers.login)}}})},rdV6:function(t,e){},tvR6:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.7d3da31ec4db2f2b8927.js.map
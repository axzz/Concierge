webpackJsonp([1],{NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("7+uW"),a=s("zL8q"),r=s.n(a),o=(s("tvR6"),{render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view",{attrs:{name:"nav"}}),this._v(" "),e("router-view",{attrs:{name:"content"}})],1)},staticRenderFns:[]}),n=s("VU/8")({name:"App",data:function(){return{}}},o,!1,null,null,null).exports,l=s("/ocq"),c="获取短信验证码",u="秒后重新获取",d="您输入的手机不是管理员，请到小程序进行注册。",p={data:function(){return{tel:"",code:"",telError:!1,numError:!1,countdownRange:60,counting:!1,activeName:"phoneLogin"}},computed:{codeButtonText:function(){return this.counting?""+this.countdownRange+u:""+c}},methods:{validate:function(){return/^1[34578][0-9]{9}$/.test(this.tel)},login:function(){var t=this;if(this.validate()&&6==this.code.length){var e={tel:this.tel,code:this.code};this.$http.post(this.GLOBAL.requestUrls.login,e).then(function(e){t.setCookie("token",e.headers.authorization,t.GLOBAL.expire),t.setCookie("name",e.data.name,1e3*t.GLOBAL.expire),t.$router.push(t.GLOBAL.routers.projects)}).catch(function(e){422===e.response.status&&(t.numError=!0)})}else this.validate()&&6==!this.code.length?this.numError=!0:this.validate()||6!=this.code.length?(this.telError=!0,this.numError=!0):this.telError=!0},countdown:function(){this.counting=!0,this._count()},getCode:function(){var t=this;if(this.telError=!this.validate(),!this.telError){var e={tel:this.tel};this.$http.post(this.GLOBAL.requestUrls.code,e).then(function(e){t.countdown()}).catch(function(e){422===e.response.status&&(t.telError=!0),403===e.response.status&&t.$message.error(d)})}},_count:function(){if(0===this.countdownRange)return this.counting=!1,void(this.countdownRange=60);this.countdownRange--,setTimeout(this._count,1e3)}}},h={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"login-com-container",staticStyle:{"background-image":"url('./static/images/login.jpg')"}},[s("el-card",{staticClass:"box-card"},[s("div",{staticClass:"login-title"},[s("span",{staticClass:"title-zn"},[t._v("预约管理系统")]),t._v(" "),s("span",{staticClass:"title-en"},[t._v("Reservation Management System")])]),t._v(" "),s("div",{staticClass:"login-content"},[s("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:"手机号登录",name:"phoneLogin"}},[s("div",{staticClass:"input-container"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.tel,expression:"tel"}],staticClass:"login-input",attrs:{type:"text",placeholder:"请输入手机号码",maxlength:"11"},domProps:{value:t.tel},on:{input:function(e){e.target.composing||(t.tel=e.target.value)}}}),t._v(" "),s("div",{staticClass:"error-msg tel-error"},[s("span",{directives:[{name:"show",rawName:"v-show",value:t.telError,expression:"telError"}]},[t._v("请输入正确的手机号")])])]),t._v(" "),s("div",{staticClass:"input-wrapper"},[s("div",{staticClass:"input-msg-container"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.code,expression:"code"}],staticClass:"login-input message-input",attrs:{type:"number",placeholder:"请输入6位短信验证码"},domProps:{value:t.code},on:{input:function(e){e.target.composing||(t.code=e.target.value)}}})]),t._v(" "),s("el-button",{attrs:{type:"text",disabled:t.counting},on:{click:t.getCode}},[t._v("\n              "+t._s(t.codeButtonText)+"\n            ")]),t._v(" "),s("div",{staticClass:"error-msg code-error"},[s("span",{directives:[{name:"show",rawName:"v-show",value:t.numError,expression:"numError"}]},[t._v("请输入正确的短信验证码")])])],1),t._v(" "),s("el-button",{staticClass:"login-btn",attrs:{type:"primary",disabled:""==t.tel||""==t.code},on:{click:t.login}},[t._v("\n            登录\n          ")])],1),t._v(" "),s("el-tab-pane",{attrs:{label:"扫码注册",name:"codeLogin"}},[s("div",{staticClass:"code-img",staticStyle:{"background-image":"url('./static/images/register.jpg')"}}),t._v(" "),s("p",{staticClass:"code-tip"},[t._v("请用微信扫描二维码注册")])])],1)],1)])],1)},staticRenderFns:[]},m=s("VU/8")(p,h,!1,null,null,null).exports,v={props:{originUrl:{type:String,default:""},className:{type:String,default:""},imageWrapper:{type:String,default:""}},data:function(){return{imgClass:this.className,imgWrapperClass:this.imageWrapper}},computed:{fomatedUrl:function(){if(this.originUrl)return this.GLOBAL.server+this.originUrl}},methods:{handleOnload:function(){this.$emit("onLoad")}}},g={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{class:this.imgWrapperClass},[e("img",{class:this.imgClass,attrs:{src:this.fomatedUrl},on:{load:this.handleOnload}})])},staticRenderFns:[]},f=s("VU/8")(v,g,!1,null,null,null).exports,_={components:{"formated-image":f},props:{project:{type:Object,default:""}},data:function(){return{imageClass:"project-image",codeClass:"code"}},methods:{handleStopPropagation:function(t){t.stopPropagation()},editProject:function(){this.$router.push(this.GLOBAL.routers.projects_edit+this.project.id)},showDetail:function(){this.$router.push(this.GLOBAL.routers.reservations_details+this.project.id+"/"+this.project.name)}}},C={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"project card-item",on:{click:t.showDetail}},[s("el-card",{attrs:{"body-style":{padding:"0px"}}},[s("formated-image",{staticClass:"image-wrapper",attrs:{originUrl:t.project.image,className:t.imageClass}}),t._v(" "),s("div",{staticStyle:{padding:"14px 12px"}},[s("div",{staticClass:"project-name"},[t._v(t._s(t.project.name))]),t._v(" "),s("div",{staticClass:"bottom bottom-flex"},["open"===t.project.state?s("div",{staticClass:"bottom-left"},[s("span",{staticClass:"state-icon",staticStyle:{"background-image":"url('./static/images/open.jpg')"}}),t._v(" "),s("span",{staticClass:"project-state"},[t._v("开启")])]):s("div",{staticClass:"bottom-left"},[s("span",{staticClass:"state-icon",staticStyle:{"background-image":"url('./static/images/close.jpg')"}}),t._v(" "),s("span",{staticClass:"project-state"},[t._v("关闭")])]),t._v(" "),s("span",{staticClass:"project-share",on:{click:function(e){return e.stopPropagation(),t.handleStopPropagation(e)}}},[s("i",{staticClass:"el-icon-edit oprerate-icon",on:{click:function(e){return e.stopPropagation(),t.editProject(e)}}}),t._v(" "),s("el-dropdown",{attrs:{trigger:"click"}},[s("span",{staticClass:"el-dropdown-link"},[s("i",{staticClass:"el-icon-share oprerate-icon"})]),t._v(" "),s("el-dropdown-menu",{staticClass:"dropdown-container",attrs:{slot:"dropdown"},slot:"dropdown"},[s("div",{staticClass:"text"},[s("span",{staticClass:"icon",staticStyle:{"background-image":"url('./static/images/wechat.png')"}}),t._v(" "),s("span",[t._v("微信扫一扫")])]),t._v(" "),s("formated-image",{staticClass:"code-wrapper",attrs:{originUrl:t.project.wxcode,className:t.codeClass}})],1)],1)],1)])])],1)],1)},staticRenderFns:[]},k="请输入分类名称",b="请选择预约项目",w="拼命加载中",L={components:{"project-entrance":s("VU/8")(_,C,!1,null,null,null).exports,"formated-image":f},data:function(){return{projectsList:[],allProjects:[],groupsList:[],checkedGroupName:"",checkedGroupId:0,checkedGroupIndex:0,checkedGroupWxcode:"",paginationCount:0,pageSize:12,currentPage:1,groupDialogVisible:!1,groupShowAll:!1,groupEditState:!1,searchState:!1,hasProjects:!0,confirmButtonDisabled:!1,codeClass:"code",group:{name:"",projects:[]},searchContent:""}},created:function(){var t=this.$loading({text:w,spinner:"el-icon-loading",background:"#fff"});this.requestAllProjects(),this.requestProjects(t)},watch:{projectsList:function(t){t.length?this.hasProjects=!0:this.hasProjects=!1}},methods:{newProject:function(){this.$router.push(this.GLOBAL.routers.projects_new)},handleDropdownCommand:function(t){if("newProject"===t)this.newProject();else{if("newGroup"!==t)return;this.group.name="",this.group.projects=[],this.groupDialogVisible=!0}},handleSearch:function(){this.checkedGroupId=0,this.checkedGroupIndex=0,this.searchState=!0,this.searchParam=this.searchContent,this.searchContent?this.goPage(1,this.pageSize,this.checkedGroupId,this.searchParam):this.handleClear()},handleClear:function(){this.searchState=!1,this.searchParam=this.searchContent,this.changeGroup(0)},refreshGroup:function(){var t=this;this.$http({method:"get",url:this.GLOBAL.requestUrls.projects,headers:{Authorization:this.getCookie("token")},params:{group:0===this.checkedGroupId?"":this.checkedGroupId,size:this.pageSize}}).then(function(e){t.projectsList=e.data.projects,t.paginationCount=e.data.count,t.setCookie("token",e.headers.authorization,t.GLOBAL.expire)})},getGroupInfo:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.group+(0===this.checkedGroupId?"":this.checkedGroupId),this.getRequestConfig()).then(function(e){t.editGroupName=e.data.name,t.editGroupProjects=e.data.projects})},changeGroup:function(t){this.checkedGroupIndex=t,this.checkedGroupId=this.groupsList[t].id,this.checkedGroupName=this.groupsList[t].name,this.checkedGroupWxcode=this.groupsList[t].wxcode,this.currentPage=1,this.refreshGroup(),this.getGroupInfo()},changeDisplay:function(){this.groupShowAll=!this.groupShowAll},handleCurrentChange:function(t){this.goPage(t,this.pageSize,this.checkedGroupId,this.searchParam)},handleSizeChange:function(t){this.pageSize=t,this.goPage(1,t,this.checkedGroupId,this.searchParam)},goPage:function(t,e,s,i){var a=this;this.$http({method:"get",url:this.GLOBAL.requestUrls.projects,headers:{Authorization:this.getCookie("token")},params:{page:t,size:e,group:0===s?"":s,search:i}}).then(function(t){a.projectsList=t.data.projects,a.paginationCount=t.data.count,a.setCookie("token",t.headers.authorization,a.GLOBAL.expire)}).catch(function(t){a.handleHttpError(t)})},requestCreateGroup:function(){var t=this;this.$http({method:"post",url:this.GLOBAL.requestUrls.groups,headers:{Authorization:this.getCookie("token")},data:{name:this.group.name,projects:this.group.projects}}).then(function(e){t.requestGroups()})},requestEditGroup:function(){var t=this;this.$http({method:"put",url:this.GLOBAL.requestUrls.group+this.checkedGroupId,headers:{Authorization:this.getCookie("token")},data:{name:this.group.name,projects:this.group.projects}}).then(function(e){t.requestGroups(),t.refreshGroup(),t.getGroupInfo()})},createGroup:function(){if(this.group.name)if(this.group.projects.length)if(this.groupEditState){if(!this.groupDialogVisible)return;this.confirmButtonDisabled=!0,this.requestEditGroup()}else{if(!this.groupDialogVisible)return;this.confirmButtonDisabled=!0,this.requestCreateGroup()}else this.$message.error(b);else this.$message.error(k)},editGroup:function(){this.groupEditState=!0,this.group.name=this.editGroupName,this.group.projects=this.editGroupProjects,this.groupDialogVisible=!0},deleteGroup:function(){var t=this;this.$http({method:"delete",url:this.GLOBAL.requestUrls.group+this.checkedGroupId,headers:{Authorization:this.getCookie("token")}}).then(function(e){t.requestGroups(),t.changeGroup(0),t.deleteDialogVisible=!1})},requestProjects:function(t){var e=this;this.$http.get(this.GLOBAL.requestUrls.projects,this.getRequestConfig()).then(function(s){e.projectsList=s.data.projects,e.paginationCount=s.data.count,e.setCookie("token",s.headers.authorization,e.GLOBAL.expire),t.close()}).catch(function(s){t.close(),401===s.response.status&&(e.delCookie("token"),e.$router.push(e.GLOBAL.routers.login))})},requestAllProjects:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.all_projects,this.getRequestConfig()).then(function(e){t.groupFirstData={id:0,name:"全部",total:e.data.projects.length,wxcode:""},t.allProjects=e.data.projects,t.groupsList.push(t.groupFirstData),t.requestGroups(),t.setCookie("token",e.headers.authorization,t.GLOBAL.expire)})},requestGroups:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.groups,this.getRequestConfig()).then(function(e){t.groupsList=[],t.groupsList.push(t.groupFirstData),t.groupsList=t.groupsList.concat(e.data),t.checkedGroupName=t.groupsList[t.checkedGroupIndex].name,t.groupDialogVisible=!1,t.confirmButtonDisabled=!1})}}},j={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"admin-com-container"},[s("div",{staticClass:"admin-com-container-wrapper"},[s("div",{staticClass:"admin-com-top"},[s("div",{staticClass:"created-search-space-between"},[t.searchState?s("span",{staticClass:"search-result-text"},[t._v("搜索结果")]):s("el-dropdown",{attrs:{"split-button":"",type:"primary",trigger:"click"},on:{click:t.newProject,command:t.handleDropdownCommand}},[s("span",{staticClass:"new-project-text"},[t._v("创建新项目")]),t._v(" "),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{attrs:{command:"newProject"}},[t._v("创建新项目")]),t._v(" "),s("el-dropdown-item",{attrs:{command:"newGroup"}},[t._v("创建新分类")])],1)],1),t._v(" "),s("el-input",{staticClass:"search-input",attrs:{clearable:"",placeholder:"搜索预约项目名称","prefix-icon":"el-icon-search"},on:{clear:t.handleClear},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.handleSearch(e):null}},model:{value:t.searchContent,callback:function(e){t.searchContent=e},expression:"searchContent"}})],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.searchState,expression:"!searchState"}],staticClass:"group-display",class:{display:t.groupShowAll,hidden:!t.groupShowAll}},[s("span",{staticClass:"control-icon",on:{click:t.changeDisplay}},[t.groupShowAll?s("span",{staticClass:"icon-container",staticStyle:{"background-image":"url('./static/images/up.jpg')"}}):s("span",{staticClass:"icon-container",staticStyle:{"background-image":"url('./static/images/down.jpg')"}})]),t._v(" "),t._m(0),t._v(" "),t._l(t.groupsList,function(e,i){return s("div",{staticClass:"group-item"},[s("span",{class:[t.checkedGroupIndex===i?"active":"","group-name"],on:{click:function(e){t.changeGroup(i)}}},[t._v(t._s(e.name))]),t._v(" "),s("span",{staticClass:"group-count"},[t._v(t._s(e.total))])])})],2),t._v(" "),s("el-dialog",{attrs:{title:t.groupEditState?"修改分类":"创建新分类",visible:t.groupDialogVisible,width:"500px"},on:{"update:visible":function(e){t.groupDialogVisible=e}}},[s("el-form",[s("el-form-item",[s("el-input",{attrs:{placeholder:"请输入分类名称"},model:{value:t.group.name,callback:function(e){t.$set(t.group,"name",e)},expression:"group.name"}})],1),t._v(" "),s("el-form-item",[s("div",{staticClass:"projects-wrapper"},[s("el-checkbox-group",{staticClass:"projects-checkbox-group",model:{value:t.group.projects,callback:function(e){t.$set(t.group,"projects",e)},expression:"group.projects"}},t._l(t.allProjects,function(e){return s("el-checkbox",{key:e.id,attrs:{label:e.id}},[t._v(t._s(e.name))])}))],1)])],1),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.groupDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.confirmButtonDisabled},on:{click:t.createGroup}},[t._v("确 定")])],1)],1)],1),t._v(" "),s("div",{staticClass:"admin-com-bottom"},[s("div",{directives:[{name:"show",rawName:"v-show",value:0!==t.checkedGroupId,expression:"checkedGroupId !== 0"}],staticClass:"group-wrapper"},[s("span",{staticClass:"group-name"},[t._v(t._s(t.checkedGroupName))]),t._v(" "),s("span",{staticClass:"group-operate-btn"},[s("i",{staticClass:"el-icon-edit",on:{click:t.editGroup}}),t._v(" "),s("el-dropdown",{attrs:{trigger:"click"}},[s("span",{staticClass:"el-dropdown-link"},[s("i",{staticClass:"el-icon-share"})]),t._v(" "),s("el-dropdown-menu",{staticClass:"dropdown-container",attrs:{slot:"dropdown"},slot:"dropdown"},[s("div",{staticClass:"text"},[s("span",{staticClass:"icon",staticStyle:{"background-image":"url('./static/images/wechat.png')"}}),t._v(" "),s("span",[t._v("微信扫一扫")])]),t._v(" "),s("formated-image",{staticClass:"code-wrapper",attrs:{originUrl:t.checkedGroupWxcode,className:t.codeClass}})],1)],1),t._v(" "),s("el-dropdown",{attrs:{trigger:"click"}},[s("span",{staticClass:"el-dropdown-link"},[s("i",{staticClass:"el-icon-delete"})]),t._v(" "),s("el-dropdown-menu",{staticClass:"dropdown-delete-container",attrs:{slot:"dropdown"},slot:"dropdown"},[s("div",{staticClass:"title"},[t._v("删除分类")]),t._v(" "),s("div",{staticClass:"content-item"},[t._v('您确定要删除"'+t._s(t.checkedGroupName)+'"分类吗?')]),t._v(" "),s("div",{staticClass:"content-item"},[t._v("1、删除分类后该分类将不在分类列表中显示。")]),t._v(" "),s("div",{staticClass:"content-item"},[t._v("2、添加了该分类的所有预约项目都将搜索不到该分类。")]),t._v(" "),s("div",{staticClass:"content-item"},[t._v("请谨慎对待!")]),t._v(" "),s("el-dropdown-item",[s("el-button",{attrs:{type:"primary"},on:{click:t.deleteGroup}},[t._v("确 定")])],1)],1)],1)],1)]),t._v(" "),t.hasProjects?s("div",{staticClass:"card-wrapper"},t._l(t.projectsList,function(t){return s("project-entrance",{key:t.id,attrs:{project:t}})})):t.searchState?s("div",{staticClass:"no-project-container"},[s("span",{staticClass:"no-project-icon",staticStyle:{"background-image":"url('./static/images/no-project.jpg')"}}),t._v(" "),s("span",{staticClass:"no-project-text"},[t._v("暂无搜索结果")])]):s("div",{staticClass:"no-project-container"},[s("span",{staticClass:"no-project-icon",staticStyle:{"background-image":"url('./static/images/no-project.jpg')"}}),t._v(" "),s("span",{staticClass:"no-project-text"},[t._v("暂无预约项目")])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.projectsList.length,expression:"projectsList.length"}],staticClass:"pagination-wrapper"},[s("el-pagination",{attrs:{"current-page":t.currentPage,"page-size":t.pageSize,"page-sizes":[4,8,12,16],layout:"total,sizes,prev, pager, next, jumper",total:t.paginationCount},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange,"update:currentPage":function(e){t.currentPage=e}}})],1)])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",{staticClass:"group-title"},[this._v("分类:")])])}]},y=s("VU/8")(L,j,!1,null,null,null).exports,x={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"nav-com-container"},[s("span",{staticClass:"nav-title"},[t._v("预约系统")]),t._v(" "),s("div",{staticClass:"drop-wrapper"},[s("el-dropdown",{attrs:{trigger:"click"},on:{command:t.handleCommand}},[s("span",{staticClass:"el-dropdown-link nick-name"},[t._v("\n        "+t._s(t.nickName)+"\n        "),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",{attrs:{command:"logout"}},[t._v("退出")])],1)],1)],1)])},staticRenderFns:[]},S=s("VU/8")({data:function(){return{nickName:"管理员"}},created:function(){this.nickName=this.getCookie("name")},methods:{handleCommand:function(t){"logout"===t&&this.logout()},logout:function(){this.delCookie("token"),this.$router.push(this.GLOBAL.routers.login)}}},x,!1,null,null,null).exports,A=s("mvHQ"),G=s.n(A),$=s("gRE1"),T=s.n($),D=s("fZjL"),V=s.n(D),I={components:{"formated-image":f},props:{image:{type:String,default:""}},data:function(){return{coverModalVisible:!1,currentImage:this.image,defaultImageList:[],classNames:{form_cover:"form-cover",default_cover:"img",image_wrapper:"item-img-wrapper",cover_wrapper:"cover-wrapper"}}},created:function(){this.getCovers()},methods:{getCovers:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.covers).then(function(e){t.defaultImageList=e.data.images,""===t.currentImage&&(t.currentImage=t.defaultImageList[0])})},handleImageOnload:function(t){this.loading&&this.loading.close()},handleUpload:function(){var t=this;this.loading=this.$loading({target:".img-wrapper",background:"#f1f1f1"}),lrz(this.$refs.uploadImageRef.files[0]).then(function(e){var s=new FormData;s.append("image",e.formData.get("file")),t.$http.post(t.GLOBAL.requestUrls.image,s,t.getRequestConfig()).then(function(e){t.currentImage=e.data.image,t.setCookie("token",e.headers.authorization,t.GLOBAL.expire)}).catch(function(e){t.handleHttpError(e)})}).catch(function(e){var s=new FormData;s.append("image",t.$refs.uploadImageRef.files[0]),t.$refs.uploadImageRef.files[0].size<5242880?t.$http.post(t.GLOBAL.requestUrls.image,s,t.getRequestConfig()).then(function(e){t.currentImage=e.data.image,t.setCookie("token",e.headers.authorization,t.GLOBAL.expire)}):(t.$message.error("上传图片过大"),t.loading.close())}),this.coverModalVisible=!1},changeCover:function(t){this.currentImage=this.defaultImageList[t],this.coverModalVisible=!1},updateValue:function(t){this.currentImage=t},getData:function(){return this.currentImage}}},B={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"img-wrapper"},[s("formated-image",{attrs:{originUrl:t.currentImage,className:t.classNames.form_cover,imageWrapper:t.classNames.cover_wrapper},on:{onLoad:t.handleImageOnload}}),t._v(" "),s("div",{staticClass:"change-cover-btn"},[s("el-button",{staticClass:"change-cover",attrs:{type:"primary"},on:{click:function(e){t.coverModalVisible=!0}}},[t._v("更换封面")]),t._v(" "),s("el-dialog",{attrs:{title:"更换封面",visible:t.coverModalVisible,width:"858px"},on:{"update:visible":function(e){t.coverModalVisible=e}}},[s("div",{staticClass:"imgs-list"},[s("div",{staticClass:"upload imgs-item"},[s("label",{attrs:{for:"file_input"}},[s("i",{staticClass:"el-icon-upload"}),t._v(" "),s("div",[t._v("上传图片")])]),t._v(" "),s("input",{ref:"uploadImageRef",attrs:{type:"file",id:"file_input",accept:"image/*"},on:{change:t.handleUpload}})]),t._v(" "),t._l(t.defaultImageList,function(e,i){return s("div",{staticClass:"imgs-item",on:{click:function(e){t.changeCover(i)}}},[s("formated-image",{attrs:{originUrl:e,className:t.classNames.default_cover,imageWrapper:t.classNames.image_wrapper}})],1)})],2)])],1)],1)},staticRenderFns:[]},O=s("VU/8")(I,B,!1,null,null,null).exports,R={props:{address:{type:String,default:""},latitude:{type:Number,default:0},longitude:{type:Number,default:0}},data:function(){return{currentAddress:this.address,currentLatitude:this.latitude,currentLongitude:this.longitude,isShowMap:!1,isShowPanel:!1,isInitMap:!0,markers:[]}},methods:{handleFocus:function(){this.isShowMap=!0,this.$route.params.id&&this.isInitMap?(this.mapInit(),this.isInitMap=!1):this.currentLatitude&&this.currentLongitude&&this.currentAddress?this.renderOriginLocation():this.currentAddress||(this.mapInit(),this.currentLatitude=0,this.currentLongitude=0)},mapInit:function(){this.map=new AMap.Map("map-container",{zoom:12}),this.geocoderInit(),this.placeSearchInit(),this.infoWindowInit(),this.mapClick(),this.renderOriginLocation()},geocoderInit:function(){var t=this;AMap.plugin("AMap.Geocoder",function(){t.geocoder=new AMap.Geocoder({radius:1e3,extensions:"all"}),t.map.addControl(t.geocoder)})},placeSearchInit:function(){var t=this;AMap.service(["AMap.PlaceSearch"],function(){t.placeSearch=new AMap.PlaceSearch({pageSize:5,pageIndex:1,city:"028",map:t.map,panel:"map-panel",renderStyle:"default"})})},infoWindowInit:function(){var t=this;AMap.plugin("AMap.InfoWindow",function(){t.infoWindow=new AMap.InfoWindow({content:"",autoMove:!0,closeWhenClickMap:!0})})},renderOriginLocation:function(){if(this.currentLatitude&&this.currentLongitude&&this.currentAddress){var t=new AMap.Marker({position:[this.currentLongitude,this.currentLatitude]});t.setMap(this.map),this.map.setZoom(14),this.map.setCenter([this.currentLongitude,this.currentLatitude]),this.markers.push(t),this.renderInfoWindow(this.currentLongitude,this.currentLatitude,t)}},mapClick:function(){var t=this;this.map.on("click",function(e){var s=e.lnglat.getLng(),i=e.lnglat.getLat();t.map.remove(t.markers),t.updatePosition(s,i),t.setMarker(s,i),t.placeSearch.clear()}),this.placeSearch.on("listElementClick",function(e){t.updateValue(t.getPositionInfo(e))}),this.placeSearch.on("markerClick",function(e){t.updateValue(t.getPositionInfo(e))})},getPositionInfo:function(t){return{latitude:t.data.location.lat,longitude:t.data.location.lng,address:t.data.cityname+t.data.adname+t.data.address}},setMarker:function(t,e){var s=new AMap.Marker({position:[t,e]});s.setMap(this.map),this.map.setZoom(14),this.map.setCenter([t,e]),this.markers.push(s),this.renderInfoWindow(t,e,s)},renderInfoWindow:function(t,e,s){var i=this;this.geocoder.getAddress([t,e],function(a,r){"complete"===a&&"OK"===r.info&&(i.currentAddress=r.regeocode.formattedAddress,i.infoWindow.setContent("<div>"+r.regeocode.formattedAddress+"</div"),i.infoWindow.open(i.map,[t,e]),s.on("click",function(){i.infoWindow.open(i.map,[t,e]),i.updatePosition(t,e)}))})},search:function(){this.isShowMap&&(this.isShowPanel=!0,this.map.remove(this.markers),this.infoWindow.close(),this.placeSearch.search(this.currentAddress))},closeMap:function(){this.isShowPanel=!1,this.placeSearch.clear(),this.isShowMap=!1},updateValue:function(t){this.currentAddress=t.address,this.currentLatitude=t.latitude,this.currentLongitude=t.longitude},updatePosition:function(t,e){this.currentLatitude=e,this.currentLongitude=t},getData:function(){return{address:this.currentAddress,latitude:this.currentLatitude,longitude:this.currentLongitude}}}},P={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"form-address"},[s("span",{staticClass:"address-text"},[t._v("详细地址: ")]),t._v(" "),s("el-input",{staticClass:"address-input",on:{focus:t.handleFocus},nativeOn:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.search(e):null}},model:{value:t.currentAddress,callback:function(e){t.currentAddress=e},expression:"currentAddress"}},[s("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.search},slot:"append"})],1)],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowMap,expression:"isShowMap"}],attrs:{id:"map-container"}}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowPanel,expression:"isShowPanel"}],attrs:{id:"map-panel"}}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowMap,expression:"isShowMap"}],staticClass:"map-close",on:{click:t.closeMap}},[s("i",{staticClass:"el-icon-close"})])])},staticRenderFns:[]},N=s("VU/8")(R,P,!1,null,null,null).exports,E={Mon:"周一",Tues:"周二",Wed:"周三",Thur:"周四",Fri:"周五",Sat:"周六",Sun:"周日",Holiday:"法定节假日"},q="请填写时间段和重复日期",M="已存在相同时间段",U="请输入正确的时间段",z=[{value:"Mon",label:"周一"},{value:"Tues",label:"周二"},{value:"Wed",label:"周三"},{value:"Thur",label:"周四"},{value:"Fri",label:"周五"},{value:"Sat",label:"周六"},{value:"Sun",label:"周日"},{value:"Holiday",label:"法定节假日"}],F={props:{timeState:{type:Object,default:{normal:[{time:"09:00-10:00",limit:10,weekday:["Mon","Tues","Wed","Thur","Fri"]}],special:[]}}},data:function(){return{weekdays:z,currentTimeState:this.timeState,settingDialogVisible:!1,isShowNormal:!0,weekdayValue:["Mon","Tues","Wed","Thur","Fri"],limitValue:"",startTime:"",endTime:"",editStatus:!1,editIndex:null}},computed:{formatedTimeState:function(){return this.currentTimeState.normal.map(function(t){var e=t.weekday.map(function(t){return E[t]});return{time:t.time,limit:t.limit,weekday:e}})}},methods:{newItem:function(){this.settingDialogVisible=!0,this.startTime="09:00",this.endTime="10:00",this.weekdayValue=["Mon","Tues","Wed","Thur","Fri"],this.limitValue=" "},validateEmpty:function(){return this.error={},this.startTime&&this.endTime&&this.weekdayValue.length||(this.error.empty_tip=q),0==V()(this.error).length},validateNewTime:function(t){var e=this;return this.error={},this.currentTimeState.normal.forEach(function(s){s.time==t&&(e.error.repeat_tip=M)}),0==V()(this.error).length},validateEditTime:function(t){var e=this;return this.error={},this.currentTimeState.normal.forEach(function(s,i){i!==e.editIndex&&s.time===t&&(e.error.repeat_tip=M)}),0==V()(this.error).length},validateTime:function(t,e){return this.error={},t>=e&&(this.error.invalid_tip=U),0==V()(this.error).length},compeleteSetting:function(){var t,e={},s=this.startTime+"-"+this.endTime,i=this.weekdayValue;t=" "===this.limitValue||""===this.limitValue?null:Math.abs(parseInt(this.limitValue)),this.validateEmpty()?(e={time:s,limit:t,weekday:i},this.validateTime(this.startTime,this.endTime)?this.editStatus?this.validateEditTime(s)?(this.currentTimeState.normal.splice(this.editIndex,1,e),this.settingDialogVisible=!1):this.$message.error(this.error.repeat_tip):this.validateNewTime(s)?(this.currentTimeState.normal.push(e),this.settingDialogVisible=!1):this.$message.error(this.error.repeat_tip):(this.settingDialogVisible=!0,this.$message.error(this.error.invalid_tip))):(this.settingDialogVisible=!0,this.$message.error(this.error.empty_tip))},deleteItem:function(t){this.currentTimeState.normal.splice(t,1)},editItem:function(t){this.settingDialogVisible=!0;var e=this.currentTimeState.normal[t];this.startTime=e.time.split("-")[0],this.endTime=e.time.split("-")[1],this.weekdayValue=e.weekday,this.limitValue=null===e.limit?" ":e.limit,this.editStatus=!0,this.editIndex=t},updateValue:function(t){this.currentTimeState=t},getData:function(){return this.currentTimeState}}},W={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"form-settime-wrapper"},[s("el-radio-group",{staticClass:"setting-pattern",model:{value:t.isShowNormal,callback:function(e){t.isShowNormal=e},expression:"isShowNormal"}},[s("el-radio-button",{attrs:{label:!0}},[t._v("常规设置")]),t._v(" "),s("el-radio-button",{attrs:{label:!1}},[t._v("特殊设置")])],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowNormal,expression:"isShowNormal"}],staticClass:"normal-setting-wrapper"},[s("div",{staticClass:"normal-setting-item-wrapper"},t._l(t.formatedTimeState,function(e,i){return s("div",{staticClass:"normal-setting-item"},[s("span",{staticClass:"item-left"},[t._v(t._s(e.time))]),t._v(" "),s("div",{staticClass:"item-right"},[s("div",{staticClass:"weekday-container",on:{click:function(e){t.editItem(i)}}},t._l(e.weekday,function(e){return s("span",{staticClass:"weekday"},[t._v(t._s(e))])})),t._v(" "),null===e.limit?s("span",{staticClass:"number"},[t._v("名额不限制")]):s("span",{staticClass:"number"},[t._v("名额"+t._s(e.limit)+"人")])]),t._v(" "),s("span",{staticClass:"operate-btn"},[s("i",{staticClass:"el-icon-circle-plus-outline",on:{click:t.newItem}}),t._v(" "),s("i",{directives:[{name:"show",rawName:"v-show",value:t.formatedTimeState.length>1,expression:"formatedTimeState.length > 1"}],staticClass:"el-icon-remove-outline",on:{click:function(e){t.deleteItem(i)}}})])])})),t._v(" "),s("el-dialog",{attrs:{title:"预约时间设置",visible:t.settingDialogVisible,width:"600px",center:""},on:{"update:visible":function(e){t.settingDialogVisible=e},close:function(e){t.editStatus=!1}}},[s("div",{staticClass:"setting-content"},[s("div",{staticClass:"fields"},[s("span",{staticClass:"text"},[t._v("时间段: ")]),t._v(" "),s("el-time-picker",{attrs:{placeholder:"开始时间","value-format":"HH:mm",format:"HH:mm"},model:{value:t.startTime,callback:function(e){t.startTime=e},expression:"startTime"}}),t._v(" "),s("span",{staticClass:"middle-text"},[t._v("至")]),t._v(" "),s("el-time-picker",{attrs:{placeholder:"结束时间","value-format":"HH:mm",format:"HH:mm"},model:{value:t.endTime,callback:function(e){t.endTime=e},expression:"endTime"}})],1),t._v(" "),s("div",{staticClass:"fields"},[s("span",{staticClass:"text"},[t._v("重复:")]),t._v(" "),s("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.weekdayValue,callback:function(e){t.weekdayValue=e},expression:"weekdayValue"}},t._l(t.weekdays,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),s("div",{staticClass:"fields"},[s("span",{staticClass:"text"},[t._v("名额限制: ")]),t._v(" "),s("el-input",{staticClass:"count-input",attrs:{placeholder:"不填写则默认为无限制",type:"number"},model:{value:t.limitValue,callback:function(e){t.limitValue=e},expression:"limitValue"}})],1)]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.settingDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:t.compeleteSetting}},[t._v("确 定")])],1)])],1)],1)},staticRenderFns:[]},H="拼命加载中",Z="预约项目名称不能为空",J="请按要求填写规范的数据",K=[{value:"day",label:"天"},{value:"hour",label:"小时"},{value:"minute",label:"分钟"}],Q=[{value:"public",label:"公开项目（任何人可在预约小程序中访问它，仅管理员可以编辑项目）"},{value:"private",label:"非公开项目（仅可通过微信分享（项目和分类）的二维码查看该项目，仅管理员可以编辑项目）"}],X={components:{"cover-picker":O,"address-picker":N,"time-setter":s("VU/8")(F,W,!1,null,null,null).exports},data:function(){return{form:{image:"",name:"",description:"",address:"",latitude:0,longitude:0,check_mode:"auto",authority:"public",time_state:{normal:[{time:"09:00-10:00",limit:10,weekday:["Mon","Tues","Wed","Thur","Fri"]}],special:[]},multi_time:!1,date_display:7},reservationLimit:{reservation_limit:!1,reservation_per_user:1},aheadTime:{ahead_time:"",time_select:"day"},selectOptions:K,authorityOptions:Q,submitButtonDisabled:!1}},created:function(){var t=this;if(this.$route.params.id){var e=this.$loading({text:H,spinner:"el-icon-loading",customClass:"loading-style"});this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id,this.getRequestConfig()).then(function(s){t.form=s.data,t.updateProps(t.form),t.updateForm(t.form),e.close()}).catch(function(s){e.close(),t.handleHttpError(s)})}},computed:{reservationLimitValid:function(){return"NaN"!==parseFloat(this.reservationLimit.reservation_per_user).toString()&&(!(this.reservationLimit.reservation_per_user<=0)&&this.reservationLimit.reservation_per_user%1==0)},displayDayValid:function(){return"NaN"!==parseFloat(this.form.date_display).toString()&&(!(this.form.date_display>7||this.form.date_display<1)&&this.form.date_display%1==0)},aheadTimeValid:function(){return""===this.aheadTime.ahead_time||"NaN"!==parseFloat(this.aheadTime.ahead_time).toString()&&(!(this.aheadTime.ahead_time<=0)&&this.aheadTime.ahead_time%1==0)}},methods:{updateProps:function(t){var e={};e.address=t.address,e.latitude=t.latitude,e.longitude=t.longitude,this.$refs.coverPickerRef.updateValue(t.image),this.$refs.addressPickerRef.updateValue(e),this.$refs.timeSetterRef.updateValue(t.time_state)},updateForm:function(t){t.reservation_per_user&&(this.reservationLimit.reservation_limit=!0,this.reservationLimit.reservation_per_user=t.reservation_per_user),this.aheadTime.time_select=V()(t.ahead_time)[0],this.aheadTime.ahead_time=T()(t.ahead_time)[0]?Number(T()(t.ahead_time)[0]):""},getComponentsData:function(){this.form.image=this.$refs.coverPickerRef.getData(),this.form.time_state=this.$refs.timeSetterRef.getData();var t=this.$refs.addressPickerRef.getData();this.form.address=t.address,this.form.latitude=t.latitude,this.form.longitude=t.longitude},getFormData:function(){var t=this;this.getComponentsData();var e=new FormData;return["name","description","address","latitude","longitude","check_mode","authority","image","multi_time","date_display"].forEach(function(s){e.append(s,t.form[s])}),e.append("time_state",G()(this.form.time_state)),this.reservationLimit.reservation_limit&&e.append("reservation_per_user",this.reservationLimit.reservation_per_user),e.append("ahead_time",G()(this.getAheadTime())),e},getAheadTime:function(){var t={};return"day"===this.aheadTime.time_select?t.day=String(this.aheadTime.ahead_time):"hour"===this.aheadTime.time_select?t.hour=String(this.aheadTime.ahead_time):"minute"===this.aheadTime.time_select&&(t.minute=String(this.aheadTime.ahead_time)),t},submitForm:function(){var t=this,e=this.getFormData();this.form.name?this.reservationLimitValid&&this.aheadTimeValid&&this.displayDayValid?(this.submitButtonDisabled=!0,this.$route.params.id?this.$http.put(this.GLOBAL.requestUrls.project+this.$route.params.id,e,this.getRequestConfig()).then(function(e){t.setCookie("token",e.headers.authorization,t.GLOBAL.expire),t.submitButtonDisabled=!1,t.$router.push(t.GLOBAL.routers.projects),t.$message.success("修改"+t.form.name+"预约项目成功")}).catch(function(e){t.submitButtonDisabled=!1,t.handleHttpError(e)}):this.$http.post(this.GLOBAL.requestUrls.projects,e,this.getRequestConfig()).then(function(e){t.setCookie("token",e.headers.authorization,t.GLOBAL.expire),t.$router.push(t.GLOBAL.routers.projects),t.submitButtonDisabled=!1,t.$message.success("添加"+t.form.name+"预约项目成功")}).catch(function(e){t.submitButtonDisabled=!1,t.handleHttpError(e)})):this.$message.error(J):this.$message.error(Z)}}},Y={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"form-com-container"},[s("div",{staticClass:"form-wrapper"},[s("div",{staticClass:"return-to-prev"},[s("router-link",{attrs:{to:"/admin/projects"}},[s("i",{staticClass:"el-icon-back"})]),t._v(" "),this.$route.params.id?s("span",[t._v("修改预约项目")]):s("span",[t._v("创建预约项目")])],1),t._v(" "),s("el-form",{ref:"form",attrs:{model:t.form}},[s("el-form-item",[s("cover-picker",{ref:"coverPickerRef",attrs:{image:t.form.image}})],1),t._v(" "),s("el-form-item",[s("div",{staticClass:"title-wrapper"},[s("el-input",{attrs:{placeholder:"请输入预约项目名称"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)]),t._v(" "),s("el-form-item",[s("div",{staticClass:"desc-wrapper"},[s("el-input",{attrs:{type:"textarea",rows:5,placeholder:"预约详情介绍或预约注意事项"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)]),t._v(" "),s("el-form-item",[s("address-picker",{ref:"addressPickerRef",attrs:{address:t.form.address,latitude:t.form.latitude,longitude:t.form.longitude}})],1),t._v(" "),s("el-form-item",[s("div",{staticClass:"form-check"},[s("span",{staticClass:"form-item-text"},[t._v("审核模式: ")]),t._v(" "),s("el-radio",{attrs:{label:"auto"},model:{value:t.form.check_mode,callback:function(e){t.$set(t.form,"check_mode",e)},expression:"form.check_mode"}},[t._v("自动审核")]),t._v(" "),s("el-radio",{attrs:{label:"manual"},model:{value:t.form.check_mode,callback:function(e){t.$set(t.form,"check_mode",e)},expression:"form.check_mode"}},[t._v("人工审核")])],1)]),t._v(" "),s("el-form-item",[s("div",{staticClass:"form-authority"},[s("span",{staticClass:"form-item-text"},[t._v("项目公开性: ")]),t._v(" "),s("el-select",{model:{value:t.form.authority,callback:function(e){t.$set(t.form,"authority",e)},expression:"form.authority"}},t._l(t.authorityOptions,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)]),t._v(" "),s("el-form-item",[s("div",{staticClass:"form-time-period-select"},[s("span",{staticClass:"form-item-text"},[t._v("预约时间设置:")]),t._v(" "),s("el-radio-group",{model:{value:t.form.multi_time,callback:function(e){t.$set(t.form,"multi_time",e)},expression:"form.multi_time"}},[s("el-radio",{attrs:{label:!1}},[t._v("预约单时段")]),t._v(" "),s("el-radio",{attrs:{label:!0}},[t._v("预约多时段")])],1)],1)]),t._v(" "),s("el-form-item",[s("time-setter",{ref:"timeSetterRef",attrs:{timeState:t.form.time_state}})],1),t._v(" "),s("el-form-item",[s("div",{staticClass:"form-reservation-limit"},[s("span",{staticClass:"form-item-text"},[t._v("单人预约上限")]),t._v(" "),s("div",{staticClass:"limit-control"},[s("el-switch",{attrs:{"active-color":"#409EFF","inactive-color":"#909997"},model:{value:t.reservationLimit.reservation_limit,callback:function(e){t.$set(t.reservationLimit,"reservation_limit",e)},expression:"reservationLimit.reservation_limit"}}),t._v(" "),t.reservationLimit.reservation_limit?s("div",{staticClass:"limit-input"},[s("span",{staticClass:"form-item-text"},[t._v("每人可预约")]),t._v(" "),s("el-input",{model:{value:t.reservationLimit.reservation_per_user,callback:function(e){t.$set(t.reservationLimit,"reservation_per_user",e)},expression:"reservationLimit.reservation_per_user"}},[s("template",{slot:"append"},[t._v("次")])],2)],1):t._e()],1),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:!t.reservationLimitValid,expression:"!reservationLimitValid"}],staticClass:"error-tip"},[t._v("请填写大于0的整数")])])]),t._v(" "),s("el-form-item",[s("div",{staticClass:"form-day-display"},[s("span",{staticClass:"form-item-text"},[s("span",[t._v("预约期限")]),t._v(" "),s("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[s("div",{attrs:{slot:"content"},slot:"content"},[t._v("即用户可预约未来多少天内的项目，最大可设置为7天，1天内指的是当天，以此推算。")]),t._v(" "),s("i",{staticClass:"el-icon-info"})])],1),t._v(" "),s("el-input",{attrs:{placeholder:"请输入1-7之间的整数"},model:{value:t.form.date_display,callback:function(e){t.$set(t.form,"date_display",e)},expression:"form.date_display"}},[s("template",{slot:"append"},[t._v("天内")])],2),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:!t.displayDayValid,expression:"!displayDayValid"}],staticClass:"error-tip"},[t._v("请填写1-7之间的整数")])],1)]),t._v(" "),s("el-form-item",[s("div",{staticClass:"form-ahead-time"},[s("span",{staticClass:"form-item-text"},[t._v("预约至少提前")]),t._v(" "),s("el-input",{staticClass:"ahead-time-input",attrs:{placeholder:"如不填写则默认可从当天开始预约"},model:{value:t.aheadTime.ahead_time,callback:function(e){t.$set(t.aheadTime,"ahead_time",e)},expression:"aheadTime.ahead_time"}},[s("template",{slot:"append"},[s("el-select",{staticClass:"ahead-time-select",model:{value:t.aheadTime.time_select,callback:function(e){t.$set(t.aheadTime,"time_select",e)},expression:"aheadTime.time_select"}},t._l(t.selectOptions,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1)],2),t._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:!t.aheadTimeValid,expression:"!aheadTimeValid"}],staticClass:"error-tip"},[t._v("请填写大于0的整数或不填写")])],1)])],1),t._v(" "),s("div",{staticClass:"form-btn"},[s("el-button",[s("router-link",{attrs:{to:"/admin/projects"}},[t._v("取消")])],1),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.submitButtonDisabled},on:{click:t.submitForm}},[t._v("确定")])],1)],1)])},staticRenderFns:[]},tt=s("VU/8")(X,Y,!1,null,null,null).exports,et={success:"已成功",wait:"待审核",cancelled:"已取消",checked:"已核销",overtime:"已过期"},st=[{value:"",label:"全部"},{value:"wait",label:et.wait},{value:"success",label:et.success},{value:"cancelled",label:et.cancelled},{value:"checked",label:et.checked},{value:"overtime",label:et.overtime}],it="取消预约",at="核销预约",rt="通过预约",ot="拼命加载中",nt="生成记录",lt="导出记录",ct={"已成功":it,"待审核":it},ut={"已成功":at,"待审核":rt},dt={data:function(){return{reservations:[],totalReservations:0,projectState:"",projectAuthority:"",reservationsDate:[],reservationsTel:"",reservationsState:"",reservationsStateOptions:st,exportButtonText:lt,processDialogVisible:!1,stateDialogVisible:!1,confirmButtonDisabled:!1,generatingState:!1,hasReservations:!0,modalTitle:"",operateRemark:"",stateCountObj:{}}},computed:{formatedReservations:function(){return this.reservations.map(function(t){return et[t.state]&&(t.state=et[t.state]),t})}},watch:{reservations:function(t){t.length?this.hasReservations=!0:this.hasReservations=!1}},created:function(){var t=this.$loading({text:ot,spinner:"el-icon-loading",customClass:"loading-style"});this.getProjectState(t),this.getReservations(),this.getStateCount()},methods:{search:function(){this.filter(1)},filter:function(t){var e=this;this.$http({method:"get",url:this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations",headers:{Authorization:this.getCookie("token")},params:{tel:this.reservationsTel,date_to:this.reservationsDate?this.reservationsDate[1]:"",date_from:this.reservationsDate?this.reservationsDate[0]:"",state:this.reservationsState,page:t}}).then(function(t){e.reservations=t.data.reservations,e.totalReservations=t.data.count}).catch(function(t){e.handleHttpError(t)})},exportReservations:function(){var t=this;this.generatingState=!0,this.exportButtonText=nt,this.$http({method:"get",url:this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations/export",headers:{Authorization:this.getCookie("token")},params:{tel:this.reservationsTel,date_to:this.reservationsDate?this.reservationsDate[1]:"",date_from:this.reservationsDate?this.reservationsDate[0]:"",state:this.reservationsState}}).then(function(e){t.generatingState=!1,t.exportButtonText=lt,window.location=t.GLOBAL.server+e.data})},dismiss:function(t,e){this.reservationsIndex=t,this.modalTitle=ct[e],this.processDialogVisible=!0},allow:function(t,e){this.reservationsIndex=t,this.modalTitle=ut[e],this.processDialogVisible=!0},handleAllow:function(t,e){var s=this;this.processDialogVisible&&(this.confirmButtonDisabled=!0,this.$http({method:"post",url:this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations/"+this.reservations[this.reservationsIndex].id+t,headers:{Authorization:this.getCookie("token")}}).then(function(t){s.reservations[s.reservationsIndex].state=et[e],s.getStateCount(),s.processDialogVisible=!1,s.confirmButtonDisabled=!1}).catch(function(t){s.confirmButtonDisabled=!1,s.handleHttpError(t)}))},handleDismiss:function(t,e){var s=this;this.processDialogVisible&&(this.confirmButtonDisabled=!0,this.$http({method:"post",url:this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations/"+this.reservations[this.reservationsIndex].id+t,headers:{Authorization:this.getCookie("token")},data:{remark:this.operateRemark}}).then(function(t){s.reservations[s.reservationsIndex].state=et[e],s.reservations[s.reservationsIndex].remark=s.operateRemark,s.operateRemark="",s.getStateCount(),s.processDialogVisible=!1,s.confirmButtonDisabled=!1}).catch(function(t){s.confirmButtonDisabled=!1,s.handleHttpError(t)}))},confirm:function(){this.modalTitle===it?this.handleDismiss("/cancel","cancelled"):this.modalTitle===at?this.handleAllow("/check","checked"):this.modalTitle===rt&&this.handleAllow("/pass","success")},handleCurrentChange:function(t){this.filter(t)},changeState:function(t){t?this.openProject():(this.projectState=!0,this.stateDialogVisible=!0)},changeAuthority:function(t){t?this.requestChangeAuthority("public"):this.requestChangeAuthority("private")},requestChangeAuthority:function(t){var e=this;this.$http({method:"patch",url:this.GLOBAL.requestUrls.authority,headers:{Authorization:this.getCookie("token")},data:{id:this.$route.params.id,authority:t}}).then(function(t){e.setCookie("token",t.headers.authorization,e.GLOBAL.expire)})},closeProject:function(){var t=this;this.stateDialogVisible&&(this.confirmButtonDisabled=!0,this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id+"/pause",this.getRequestConfig()).then(function(e){t.getReservations(),t.getStateCount(),t.projectState=!1,t.stateDialogVisible=!1,t.confirmButtonDisabled=!1}).catch(function(e){t.confirmButtonDisabled=!1,t.handleHttpError(e)}))},openProject:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id+"/open",this.getRequestConfig()).then(function(t){}).catch(function(e){t.handleHttpError(e)})},getStateCount:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations/count",this.getRequestConfig()).then(function(e){t.stateCountObj=e.data}).catch(function(e){t.handleHttpError(e)})},getReservations:function(){var t=this;this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id+"/reservations",this.getRequestConfig()).then(function(e){t.reservations=e.data.reservations,t.totalReservations=e.data.count}).catch(function(e){t.handleHttpError(e)})},getProjectState:function(t){var e=this;this.$http.get(this.GLOBAL.requestUrls.project+this.$route.params.id,this.getRequestConfig()).then(function(s){"open"===s.data.state?e.projectState=!0:e.projectState=!1,"private"===s.data.authority?e.projectAuthority=!1:e.projectAuthority=!0,t.close()}).catch(function(s){t.close(),e.handleHttpError(s)})}}},pt={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"detail-com-container"},[s("div",{staticClass:"return-to-prev-wrapper"},[s("div",{staticClass:"return-to-prev"},[s("router-link",{attrs:{to:"/admin/projects"}},[s("i",{staticClass:"el-icon-back"})]),t._v(" "),s("span",{staticClass:"reservation-name"},[t._v(t._s(this.$route.params.projectName)+"预约记录")]),t._v(" "),s("span",{staticClass:"project-state"},[t._v("开启预约")]),t._v(" "),s("el-switch",{attrs:{"active-color":"#409EFF","inactive-color":"#909997"},on:{change:t.changeState},model:{value:t.projectState,callback:function(e){t.projectState=e},expression:"projectState"}}),t._v(" "),s("span",{staticClass:"project-authority"},[t._v("项目公开性")]),t._v(" "),s("el-switch",{attrs:{"active-color":"#409EFF","inactive-color":"#909997"},on:{change:t.changeAuthority},model:{value:t.projectAuthority,callback:function(e){t.projectAuthority=e},expression:"projectAuthority"}}),t._v(" "),s("el-dialog",{attrs:{title:"确认关闭",visible:t.stateDialogVisible,width:"500px"},on:{"update:visible":function(e){t.stateDialogVisible=e}}},[s("span",[t._v("关闭项目后，该项目下的所有预约都会被自动取消，您确认要关闭么?")]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.stateDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.confirmButtonDisabled},on:{click:t.closeProject}},[t._v("确 定")])],1)])],1)]),t._v(" "),s("div",{staticClass:"reservations-list"},[s("div",{staticClass:"reservations-search"},[s("el-date-picker",{staticClass:"date-picker",attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:t.reservationsDate,callback:function(e){t.reservationsDate=e},expression:"reservationsDate"}}),t._v(" "),s("div",{staticClass:"reservations-tel"},[s("span",[t._v("联系电话: ")]),t._v(" "),s("el-input",{staticClass:"tel-input",model:{value:t.reservationsTel,callback:function(e){t.reservationsTel=e},expression:"reservationsTel"}})],1),t._v(" "),s("div",{staticClass:"reservations-state"},[s("span",[t._v("预约状态: ")]),t._v(" "),s("el-select",{staticClass:"state-select",model:{value:t.reservationsState,callback:function(e){t.reservationsState=e},expression:"reservationsState"}},t._l(t.reservationsStateOptions,function(t){return s("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),s("el-button",{staticClass:"search-btn",attrs:{type:"primary"},on:{click:t.search}},[t._v("查询")]),t._v(" "),s("el-button",{staticClass:"search-btn",attrs:{type:"primary",loading:t.generatingState},on:{click:t.exportReservations}},[t._v("\n          "+t._s(t.exportButtonText)+"\n      ")])],1),t._v(" "),s("div",{staticClass:"reservations-list-body"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.hasReservations,expression:"hasReservations"}],staticClass:"list-wrapper"},[t._m(0),t._v(" "),t._l(t.formatedReservations,function(e,i){return s("div",{directives:[{name:"show",rawName:"v-show",value:t.hasReservations,expression:"hasReservations"}],key:e.id,staticClass:"table-item"},[s("span",{staticClass:"name item"},[t._v(t._s(e.name))]),t._v(" "),s("span",{staticClass:"item"},[t._v(t._s(e.state))]),t._v(" "),s("span",{staticClass:"item"},[t._v(t._s(e.tel))]),t._v(" "),s("span",{staticClass:"date item"},[t._v(t._s(e.date))]),t._v(" "),s("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[s("div",{attrs:{slot:"content"},slot:"content"},t._l(e.time,function(e){return s("span",[t._v(t._s(e)),s("br")])})),t._v(" "),s("span",{staticClass:"time item"},t._l(e.time,function(e){return s("span",{staticClass:"time-cell"},[t._v(t._s(e))])}))]),t._v(" "),s("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[s("div",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.remark))]),t._v(" "),s("span",{staticClass:"remark item"},[t._v(t._s(e.remark))])]),t._v(" "),"已成功"===e.state?s("span",{staticClass:"operate item"},[s("span",{staticClass:"operate-set",on:{click:function(s){t.allow(i,e.state)}}},[t._v("核销")]),t._v(" "),s("span",{staticClass:"operate-set",on:{click:function(s){t.dismiss(i,e.state)}}},[t._v("取消")])]):"待审核"===e.state?s("span",{staticClass:"operate item"},[s("span",{staticClass:"operate-set",on:{click:function(s){t.allow(i,e.state)}}},[t._v("通过")]),t._v(" "),s("span",{staticClass:"operate-set",on:{click:function(s){t.dismiss(i,e.state)}}},[t._v("取消")])]):s("span",{staticClass:"operate item"},[t._v("---")])],1)})],2),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.hasReservations,expression:"!hasReservations"}],staticClass:"no-reservation-container"},[s("span",{staticClass:"no-reservation-icon",staticStyle:{"background-image":"url('./static/images/no-project.jpg')"}}),t._v(" "),s("span",{staticClass:"no-reservation-text"},[t._v("暂无预约记录")])]),t._v(" "),s("el-dialog",{ref:"modalRef",attrs:{title:t.modalTitle,visible:t.processDialogVisible,width:"500px"},on:{"update:visible":function(e){t.processDialogVisible=e}}},["取消预约"===t.modalTitle?s("el-input",{staticClass:"border-bottom",attrs:{placeholder:"请输入处理意见"},model:{value:t.operateRemark,callback:function(e){t.operateRemark=e},expression:"operateRemark"}}):"核销预约"===t.modalTitle?s("span",[t._v("是否核销该预约?")]):s("span",[t._v("是否通过该预约?")]),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.processDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),s("el-button",{attrs:{type:"primary",disabled:t.confirmButtonDisabled},on:{click:t.confirm}},[t._v("确 定")])],1)],1),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.reservations.length,expression:"reservations.length"}],staticClass:"reservations-list-bottom"},[s("div",{staticClass:"state-count"},[s("span",[t._v("总计: "),s("span",{staticClass:"state-number"},[t._v(t._s(t.stateCountObj.total))])]),t._v(" "),s("span",[t._v("待审核: "),s("span",{staticClass:"state-number"},[t._v(t._s(t.stateCountObj.wait))])]),t._v(" "),s("span",[t._v("已成功: "),s("span",{staticClass:"state-number"},[t._v(t._s(t.stateCountObj.success))])]),t._v(" "),s("span",[t._v("已核销: "),s("span",{staticClass:"state-number"},[t._v(t._s(t.stateCountObj.checked))])]),t._v(" "),s("span",[t._v("已取消: "),s("span",{staticClass:"state-number"},[t._v(t._s(t.stateCountObj.cancelled))])]),t._v(" "),s("span",[t._v("已过期: "),s("span",{staticClass:"state-number"},[t._v(t._s(t.stateCountObj.overtime))])])]),t._v(" "),s("div",{staticClass:"pagination-wrapper"},[s("el-pagination",{attrs:{"page-size":20,layout:"prev, pager, next, jumper",total:t.totalReservations},on:{"current-change":t.handleCurrentChange}})],1)])],1)])])},staticRenderFns:[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"table-item table-head"},[s("span",{staticClass:"item"},[t._v("姓名")]),t._v(" "),s("span",{staticClass:"item"},[t._v("预约状态")]),t._v(" "),s("span",{staticClass:"item"},[t._v("联系电话")]),t._v(" "),s("span",{staticClass:"date item"},[t._v("预约日期")]),t._v(" "),s("span",{staticClass:"time item"},[t._v("预约时间段")]),t._v(" "),s("span",{staticClass:"remark item"},[t._v("备注")]),t._v(" "),s("span",{staticClass:"operate item"},[t._v("操作")])])}]},ht=s("VU/8")(dt,pt,!1,null,null,null).exports;i.default.use(l.a);var mt=new l.a({routes:[{path:"/",components:{nav:S,content:y}},{path:"/login",components:{nav:"",content:m}},{path:"/admin/projects",components:{nav:S,content:y}},{path:"/admin/projects/new",components:{nav:S,content:tt}},{path:"/admin/projects/edit/:id",components:{nav:S,content:tt}},{path:"/admin/projects/reservation/:id/:projectName",components:{nav:S,content:ht}}],mode:"hash"}),vt=s("mtWM"),gt=s.n(vt),ft=s("Rf8U"),_t=s.n(ft),Ct=(s("U7mS"),s("rdV6"),{server:"",expire:1296e5,routers:{login:"/login",projects:"/admin/projects",projects_new:"/admin/projects/new",projects_edit:"/admin/projects/edit/",reservations_details:"/admin/projects/reservation/"},requestUrls:{code:"/code",login:"/login",projects:"/projects",project:"/projects/",covers:"/covers",image:"/image",all_projects:"/all-projects",groups:"/groups",group:"/groups/",authority:"/project/authority"},httpStateInfo:{invalid_token:"Invalid Token"}}),kt=s("VU/8")(Ct,null,!1,null,null,null).exports;function bt(t){var e,s=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(s))?e[2]:null}function wt(t){var e=new Date;e.setTime(e.getTime()-1);var s=bt(t);null!=s&&(document.cookie=t+"="+s+";expires="+e.toGMTString())}i.default.config.productionTip=!1,i.default.use(r.a),i.default.use(_t.a,gt.a),i.default.prototype.setCookie=function(t,e,s){var i=new Date;i.setTime(i.getTime()+s),document.cookie=t+"="+e+(null==s?"":";expires="+i.toGMTString())},i.default.prototype.getCookie=bt,i.default.prototype.delCookie=wt,i.default.prototype.handleHttpError=function(t){401===t.response.status&&(t.response.data===kt.httpStateInfo.invalid_token?(wt("token"),mt.push(kt.routers.login),r.a.Message.error("登录已过期，请重新登录。")):mt.push(kt.routers.projects))},i.default.prototype.getRequestConfig=function(){return{headers:{Authorization:bt("token")}}},i.default.prototype.GLOBAL=kt,new i.default({el:"#app",router:mt,components:{App:n},template:"<App/>",created:function(){this.checkLogin()},watch:{$route:function(t,e){this.checkLogin()}},methods:{checkLogin:function(){this.getCookie("token")?this.$route.path==this.GLOBAL.routers.login?this.$router.push(this.GLOBAL.routers.projects):this.$router.push(this.$route.path):this.$router.push(this.GLOBAL.routers.login)}}})},rdV6:function(t,e){},tvR6:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.f8d50a57357b3a7f7431.js.map